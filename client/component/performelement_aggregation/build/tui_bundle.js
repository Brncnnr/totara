(()=>{var e={wqWL:(e,t,n)=>{var a={"./AggregationAdminEdit":"gBGw","./AggregationAdminEdit.vue":"gBGw","./AggregationAdminSummary":"xIkR","./AggregationAdminSummary.vue":"xIkR","./AggregationAdminView":"OTWQ","./AggregationAdminView.vue":"OTWQ","./AggregationParticipantForm":"Aqtx","./AggregationParticipantForm.vue":"Aqtx"};function r(e){var t=i(e);return n(t)}function i(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=i,e.exports=r,r.id="wqWL"},gBGw:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>x});const a=tui.require("tui/components/uniform"),r=tui.require("tui/components/form/Checkbox");var i=n.n(r);const l=tui.require("tui/components/loading/Loader");var o=n.n(l);const s=tui.require("tui/components/form/Repeater");var u=n.n(s);const d=tui.require("tui/components/icons/Add");var c=n.n(d);const m=tui.require("tui/components/buttons/ButtonIcon");var g=n.n(m);const p=tui.require("mod_perform/components/element/PerformAdminCustomElementEdit");var _=n.n(p);const f={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"performelement_aggregation_aggregatable_question_elements"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"aggregatable_question_elements_input"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"performelement_aggregation_aggregatable_question_elements"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"sections"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",alias:{kind:"Name",value:"title"},name:{kind:"Name",value:"display_title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"aggregatable_section_elements"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"element"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"element_plugin"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}]}}]}}]}}]}}]},v={components:{Checkbox:i(),FormCheckboxGroup:a.FormCheckboxGroup,FormRow:a.FormRow,FormSelect:a.FormSelect,FormNumber:a.FormNumber,Repeater:u(),FieldArray:a.FieldArray,AddIcon:c(),ButtonIcon:g(),Loader:o(),PerformAdminCustomElementEdit:_()},inheritAttrs:!1,props:{identifier:String,rawData:Object,rawTitle:String,settings:Object,data:Object,currentActivityId:Number,extraPluginConfigData:Object},data(){const e={sourceSectionElementIds:this.createValuesForRepeater(this.rawData.sourceSectionElementIds,!1),calculations:this.rawData.calculations,excludedValues:this.createValuesForRepeater(this.rawData.excludedValues,!0),identifier:this.identifier,rawTitle:this.rawTitle};return{loading:!1,initialValues:e,questionCounter:e.sourceSectionElementIds.length,excludedValuesCounter:e.excludedValues.length}},computed:{activityAggregatableElementOptions(){const e=this.rawData.aggregatableSections;let t;if(!e||0===e.length)return[{id:null,label:this.$str("no_available_questions","performelement_aggregation")}];t=e.length>1?e.map((e=>({label:e.title,options:e.aggregatable_section_elements.map((e=>({id:e.id,label:e.element.title})))}))):e[0].aggregatable_section_elements.map((e=>({id:e.id,label:e.element.title})));let n={id:null,label:this.$str("select_question_element","performelement_aggregation")};return t.unshift(n),t},calculationOptions(){return this.extraPluginConfigData.calculations}},created(){this.rawData.aggregatableSections||this.fetchAggregatableSectionElements()},methods:{async fetchAggregatableSectionElements(){this.loading=!0;const e=await this.$apollo.query({query:f,variables:{input:{activity_id:this.currentActivityId}},fetchPolicy:"network-only"});this.$set(this.rawData,"aggregatableSections",e.data.performelement_aggregation_aggregatable_question_elements.sections),this.loading=!1},getElementForUpdate:e=>(e.data.sourceSectionElementIds=e.data.sourceSectionElementIds.map((e=>e.value)),e.data.excludedValues=e.data.excludedValues.map((e=>e.value)),e),createValuesForRepeater(e,t){e||(e=[]);const n=e.map(((e,t)=>({name:t,value:e})));return 0===n.length&&n.push(this.createEmptyRepeaterValue(n.length)),1!==n.length||t||n.push(this.createEmptyRepeaterValue(n.length)),n},createEmptyRepeaterValue:e=>({name:e,value:null}),sourceSectionElementsValidation(e){const t=this.$str("duplicate_questions_validation_error","performelement_aggregation"),n=t=>{if(t.value)return e.some((e=>e.name!==t.name&&Number(e.value)===Number(t.value)))};return e.map((e=>({value:n(e)?t:null})))}}},h=function(e){e.options.__langStrings={performelement_aggregation:["add_excluded_value","add_question","aggregate_question_n","calculations_to_display","duplicate_questions_validation_error","excluded_value_n","excluded_values","excluded_values","excluded_values_help_text","no_available_questions","questions_for_response_aggregation","questions_to_aggregate","select_question_element"]}};var b=(0,n("wWJ2").Z)(v,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-aggregationAdminEdit"},[n("PerformAdminCustomElementEdit",{attrs:{"initial-values":e.initialValues,settings:e.settings,"validation-mode":"auto"},on:{cancel:function(t){return e.$emit("display")},update:function(t){e.$emit("update",e.getElementForUpdate(t))}}},[n("FormRow",{attrs:{label:e.$str("questions_to_aggregate","performelement_aggregation"),required:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.labelId;return[n("Loader",{attrs:{loading:e.loading}},[n("FieldArray",{attrs:{path:"sourceSectionElementIds",validate:e.sourceSectionElementsValidation},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.items,i=t.push,l=t.remove;return[n("Repeater",{attrs:{rows:r,"min-rows":2,"delete-icon":!0,"aria-labelledby":a},on:{add:function(e){return i()},remove:function(e,t){return l(t)}},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.index;return[n("FormSelect",{attrs:{"aria-label":e.$str("aggregate_question_n","performelement_aggregation",a+1),options:e.activityAggregatableElementOptions,name:[a,"value"],validations:function(e){return[e.required()]}}})]}},{key:"add",fn:function(){return[n("ButtonIcon",{attrs:{"aria-label":e.$str("add_question","performelement_aggregation"),styleclass:{small:!0},text:e.$str("add_question","performelement_aggregation")},on:{click:function(t){i(e.createEmptyRepeaterValue(e.questionCounter++))}}},[n("AddIcon")],1)]},proxy:!0}],null,!0)})]}}],null,!0)})],1)]}}])}),e._v(" "),n("FormRow",{attrs:{label:e.$str("calculations_to_display","performelement_aggregation"),required:""},scopedSlots:e._u([{key:"default",fn:function(t){return t.labelId,[n("FormCheckboxGroup",{attrs:{validations:function(e){return[e.required()]},name:"calculations"}},e._l(e.calculationOptions,(function(t){return n("Checkbox",{key:t.name,attrs:{value:t.name}},[e._v("\n          "+e._s(t.label)+"\n        ")])})),1)]}}])}),e._v(" "),n("FormRow",{attrs:{label:e.$str("excluded_values","performelement_aggregation"),helpmsg:e.$str("excluded_values_help_text","performelement_aggregation")},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.labelId;return[n("FieldArray",{attrs:{path:"excludedValues"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.items,i=t.push,l=t.remove;return[n("Repeater",{attrs:{rows:r,"min-rows":1,"delete-icon":!0,"aria-labelledby":a},on:{add:function(e){return i()},remove:function(e,t){return l(t)}},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.index;return[n("FormNumber",{attrs:{"aria-label":e.$str("excluded_value_n","performelement_aggregation",a+1),name:[a,"value"],"char-length":"4"}})]}},{key:"add",fn:function(){return[n("ButtonIcon",{attrs:{"aria-label":e.$str("add_excluded_value","performelement_aggregation"),styleclass:{small:!0}},on:{click:function(t){i(e.createEmptyRepeaterValue(e.excludedValuesCounter++))}}},[n("AddIcon")],1)]},proxy:!0}],null,!0)})]}}],null,!0)})]}}])})],1)],1)}),[],!1,null,null,null);h(b),b.options.__hasBlocks={script:!0,template:!0};const x=b.exports},xIkR:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});const a=tui.require("mod_perform/components/element/PerformAdminCustomElementSummary"),r={components:{PerformAdminCustomElementSummary:n.n(a)()},props:{data:Object,identifier:String,isRequired:Boolean,settings:Object,title:String,type:Object,extraPluginConfigData:Object},computed:{extraFields(){const e=[{title:this.$str("questions_for_response_aggregation","performelement_aggregation"),options:this.sectionElementsForAggregation.map((e=>({value:`${e.element.title} (${e.element.element_plugin.name})`})))},{title:this.$str("calculations_to_display","performelement_aggregation"),options:this.calculationsToDisplay.map((e=>({value:e})))}];return this.hasExcludedValues&&e.push({title:this.$str("excluded_values","performelement_aggregation"),helpmsg:this.$str("excluded_values_help_text","performelement_aggregation"),options:this.excludedValues.map((e=>({value:e})))}),e},sectionElementsForAggregation(){return this.data.sourceSectionElementIds.map((e=>this.aggregatableSectionElements.find((t=>Number(t.id)===Number(e)))))},aggregatableSectionElements(){return this.data.aggregatableSections.reduce(((e,t)=>[...e,...t.aggregatable_section_elements]),[])},calculationsToDisplay(){const e=this.extraPluginConfigData.calculations;return this.data.calculations.map((t=>e.find((e=>e.name===t)).label))},hasExcludedValues(){return this.excludedValues.length>0},excludedValues(){return this.data.excludedValues?this.data.excludedValues.filter((e=>null!==e&&""!==e.trim())):[]}}},i=function(e){e.options.__langStrings={performelement_aggregation:["calculations_to_display","excluded_values","excluded_values_help_text","questions_for_response_aggregation"]}};var l=(0,n("wWJ2").Z)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-redisplayAdminSummary"},[n("PerformAdminCustomElementSummary",{attrs:{"extra-fields":e.extraFields,identifier:e.identifier,"is-required":e.isRequired,settings:e.settings,title:e.title},on:{display:function(t){return e.$emit("display")}}})],1)}),[],!1,null,null,null);i(l),l.options.__hasBlocks={script:!0,template:!0};const o=l.exports},OTWQ:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});const a={inheritAttrs:!1,props:{data:Object,extraPluginConfigData:Object},computed:{hasExcludedValues(){return this.excludedValues.length>0},excludedValuesCsv(){return this.excludedValues.join(", ")},excludedValues(){return this.data.excludedValues?this.data.excludedValues.filter((e=>null!==e&&""!==e.trim())):[]},aggregationTypesPreview(){const e=this.$str("calculated_value_preview_placeholder","performelement_aggregation"),t=this.extraPluginConfigData.calculations;return this.data.calculations.map((n=>{const a=t.find((e=>e.name===n)).label;return this.$str("aggregated_response_display","performelement_aggregation",{label:a,value:e})}))}}},r=function(e){e.options.__langStrings={performelement_aggregation:["aggregated_response_display","header_blurb","header_blurb_with_exclusions","calculated_value_preview_placeholder"]}};var i=(0,n("wWJ2").Z)(a,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-aggregationAdminView"},[e.hasExcludedValues?n("div",[e._v("\n    "+e._s(e.$str("header_blurb_with_exclusions","performelement_aggregation",e.excludedValuesCsv))+"\n  ")]):n("div",{staticClass:"tui-aggregationAdminView__blurb"},[e._v("\n    "+e._s(e.$str("header_blurb","performelement_aggregation"))+"\n  ")]),e._v(" "),n("div",e._l(e.aggregationTypesPreview,(function(t,a){return n("div",{key:a},[e._v("\n      "+e._s(t)+"\n    ")])})),0)])}),[],!1,null,null,null);r(i),i.options.__hasBlocks={script:!0,template:!0};const l=i.exports},Aqtx:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});const a=tui.require("mod_perform/components/element/ElementParticipantResponse");var r=n.n(a);const i=tui.require("mod_perform/components/element/participant_form/ResponseDisplay");var l=n.n(i);const o=tui.require("mod_perform/components/element/ElementParticipantFormContent"),s={components:{ElementParticipantFormContent:n.n(o)(),ElementParticipantResponse:r(),ResponseDisplay:l()},props:{path:[String,Array],error:String,isDraft:Boolean,element:{type:Object,required:!0},participantInstanceId:{type:Number,required:!1},sectionElement:{type:Object,required:!0}},computed:{hasExcludedValues(){return this.excludedValues.length>0},excludedValuesCsv(){return this.excludedValues.join(", ")},excludedValues(){return this.element.data.excludedValues?this.element.data.excludedValues.filter((e=>null!==e&&""!==String(e).trim())):[]}}},u=function(e){e.options.__langStrings={performelement_aggregation:["header_blurb","header_blurb_with_exclusions"]}};var d=(0,n("wWJ2").Z)(s,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-aggregationParticipantForm"},[e.hasExcludedValues?n("div",[e._v("\n    "+e._s(e.$str("header_blurb_with_exclusions","performelement_aggregation",e.excludedValuesCsv))+"\n  ")]):n("div",[e._v("\n    "+e._s(e.$str("header_blurb","performelement_aggregation"))+"\n  ")]),e._v(" "),n("ElementParticipantFormContent",e._b({attrs:{"participant-can-answer":e.sectionElement.can_respond,element:e.element,"section-element":e.sectionElement,"from-print":!1,"is-draft":e.isDraft},scopedSlots:e._u([{key:"content",fn:function(t){return t.labelId,[n("ElementParticipantResponse",{scopedSlots:e._u([{key:"content",fn:function(){return[n("ResponseDisplay",{attrs:{element:e.element,data:e.sectionElement.response_data_formatted_lines}})]},proxy:!0}],null,!0)})]}}])},"ElementParticipantFormContent",e.$attrs,!1))],1)}),[],!1,null,null,null);u(d),d.options.__hasBlocks={script:!0,template:!0};const c=d.exports},wWJ2:(e,t,n)=>{"use strict";function a(e,t,n,a,r,i,l,o){var s,u="function"==typeof e?e.options:e;if(t&&(u.render=t,u.staticRenderFns=n,u._compiled=!0),a&&(u.functional=!0),i&&(u._scopeId="data-v-"+i),l?(s=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(l)},u._ssrRegister=s):r&&(s=o?function(){r.call(this,(u.functional?this.parent:this).$root.$options.shadowRoot)}:r),s)if(u.functional){u._injectStyles=s;var d=u.render;u.render=function(e,t){return s.call(t),d(e,t)}}else{var c=u.beforeCreate;u.beforeCreate=c?[].concat(c,s):[s]}return{exports:e,options:u}}n.d(t,{Z:()=>a})}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){"use strict";"undefined"!=typeof tui&&tui._bundle.isLoaded("performelement_aggregation")?console.warn('[tui bundle] The bundle "performelement_aggregation" is already loaded, skipping initialisation.'):(tui._bundle.register("performelement_aggregation"),tui._bundle.addModulesFromContext("performelement_aggregation/components",n("wqWL")))}()})();