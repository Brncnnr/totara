(()=>{var e={KWZD:(e,t,i)=>{var n={"./api_client/ClientActions":"8rQ8","./api_client/ClientActions.vue":"8rQ8","./form/Duration":"Gmfq","./form/Duration.vue":"Gmfq","./uniform/FormDuration":"F5L3","./uniform/FormDuration.vue":"F5L3"};function a(e){var t=r(e);return i(t)}function r(e){if(!i.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}a.keys=function(){return Object.keys(n)},a.resolve=r,e.exports=a,a.id="KWZD"},YKew:(e,t,i)=>{var n={"./duration":"IJDg","./duration.js":"IJDg","./error_response":"pckc","./error_response.js":"pckc","./service_account":"sK66","./service_account.js":"sK66"};function a(e){var t=r(e);return i(t)}function r(e){if(!i.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}a.keys=function(){return Object.keys(n)},a.resolve=r,e.exports=a,a.id="YKew"},Yrvf:(e,t,i)=>{var n={"./AddClient":"Iw6L","./AddClient.vue":"Iw6L","./Clients":"68hr","./Clients.vue":"68hr","./EditClient":"yv7m","./EditClient.vue":"yv7m","./EditClientSettings":"NOhP","./EditClientSettings.vue":"NOhP"};function a(e){var t=r(e);return i(t)}function r(e){if(!i.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}a.keys=function(){return Object.keys(n)},a.resolve=r,e.exports=a,a.id="Yrvf"},U26W:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"totara_api_search_users"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"totara_api_search_users_input"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"result"},name:{kind:"Name",value:"totara_api_search_users"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"users"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"fullname"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"card_display"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profile_picture_alt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profile_picture_url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profile_url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"display_fields"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"is_custom"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"associate_url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"value"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]}]}}]}}]}}]}}]}}]}},"8rQ8":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>m});const n=tui.require("tui/components/dropdown/Dropdown");var a=i.n(n);const r=tui.require("tui/components/buttons/MoreIcon");var s=i.n(r);const o=tui.require("tui/components/dropdown/DropdownItem");var l=i.n(o);const d={components:{Dropdown:a(),MoreIcon:s(),DropdownItem:l()},props:{clientName:{type:String,required:!0},tenantId:Number,tenantSuspended:Boolean,clientStatusEnabled:{type:Boolean,required:!0},clientId:{type:String,required:!0}},computed:{getEditClientSettingsPageUrl(){let e={client_id:this.clientId};return this.tenantId&&(e.tenant_id=this.tenantId),this.$url("/totara/api/client/settings.php",e)}}},u=function(e){e.options.__langStrings={core:["delete"],totara_api:["actions_for","delete_client_name","disable_client","disable_client_name","edit_client_details","edit_client_details_name","edit_client_settings","edit_client_settings_name","enable_client","enable_client_name"]}};var c=(0,i("wWJ2").Z)(d,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"tui-totara_api-clientActions"},[i("Dropdown",{scopedSlots:e._u([{key:"trigger",fn:function(t){var n=t.toggle,a=t.isOpen;return[i("MoreIcon",{attrs:{"aria-expanded":a?"true":"false","aria-label":e.$str("actions_for","totara_api",e.clientName),size:300},on:{click:n}})]}}])},[e._v(" "),i("DropdownItem",{attrs:{title:e.$str("edit_client_details_name","totara_api",e.clientName),"aria-label":e.$str("edit_client_details_name","totara_api",e.clientName),href:e.$url("/totara/api/client/edit.php",{id:e.clientId})}},[e._v("\n      "+e._s(e.$str("edit_client_details","totara_api"))+"\n    ")]),e._v(" "),i("DropdownItem",{attrs:{title:e.$str("edit_client_settings_name","totara_api",e.clientName),"aria-label":e.$str("edit_client_settings_name","totara_api",e.clientName),href:e.getEditClientSettingsPageUrl}},[e._v("\n      "+e._s(e.$str("edit_client_settings","totara_api"))+"\n    ")]),e._v(" "),e.clientStatusEnabled?i("DropdownItem",{attrs:{title:e.$str("disable_client_name","totara_api",e.clientName),"aria-label":e.$str("disable_client_name","totara_api",e.clientName)},on:{click:function(t){return e.$emit("disable-api-client")}}},[e._v("\n      "+e._s(e.$str("disable_client","totara_api"))+"\n    ")]):i("DropdownItem",{attrs:{title:e.$str("enable_client_name","totara_api",e.clientName),"aria-label":e.$str("enable_client_name","totara_api",e.clientName),disabled:e.tenantSuspended},on:{click:function(t){return e.$emit("enable-api-client")}}},[e._v("\n      "+e._s(e.$str("enable_client","totara_api"))+"\n    ")]),e._v(" "),i("DropdownItem",{attrs:{title:e.$str("delete_client_name","totara_api",e.clientName),"aria-label":e.$str("delete_client_name","totara_api",e.clientName)},on:{click:function(t){return e.$emit("delete-api-client")}}},[e._v("\n      "+e._s(e.$str("delete","core"))+"\n    ")])],1)],1)}),[],!1,null,null,null);u(c),c.options.__hasBlocks={script:!0,template:!0};const m=c.exports},Gmfq:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>_});const n=tui.require("tui/components/form/InputNumber");var a=i.n(n);const r=tui.require("tui/components/form/Select");var s=i.n(r);const o=tui.require("tui/components/form/Label");var l=i.n(o),d=i("AO2P");const u={components:{InputNumber:a(),Select:s(),Label:l()},props:{value:Number,ariaLabel:{type:String,default:""}},data(){return{durationValue:null,durationUnits:"",unitOptions:[{id:d.Units.WEEKS,label:this.$str("duration_weeks","totara_api")},{id:d.Units.DAYS,label:this.$str("duration_days","totara_api")},{id:d.Units.HOURS,label:this.$str("duration_hours","totara_api")},{id:d.Units.MINUTES,label:this.$str("duration_minutes","totara_api")},{id:d.Units.SECONDS,label:this.$str("duration_seconds","totara_api")}]}},computed:{durationInSeconds(){if(null==this.durationValue||!this.durationUnits)return null;const e=d.unitsInSeconds.find((e=>e.id===this.durationUnits));return this.durationValue*e.seconds}},watch:{value:{handler:"setDurationFromValue"}},mounted(){this.setDurationFromValue()},methods:{setDurationFromValue(){if(null==this.value)return void(null!=this.durationInSeconds&&(this.durationValue=null));if(this.value==this.durationInSeconds)return;const e=(0,d.parseSeconds)(this.value);this.durationValue=e.value,this.durationUnits=e.units}}},c=function(e){e.options.__langStrings={totara_api:["duration_seconds","duration_minutes","duration_hours","duration_days","duration_weeks","duration_value_label","duration_units_label"]}};var m=(0,i("wWJ2").Z)(u,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"tui-totara_api-duration",attrs:{role:"group"}},[i("Label",{attrs:{"for-id":e.$id("duration-value"),label:e.$str("duration_value_label","totara_api",e.ariaLabel),hidden:!0}}),e._v(" "),i("InputNumber",{attrs:{id:e.$id("duration-value")},on:{input:function(t){return e.$emit("input",e.durationInSeconds)},blur:function(t){return e.$emit("blur")}},model:{value:e.durationValue,callback:function(t){e.durationValue=t},expression:"durationValue"}}),e._v(" "),i("Label",{attrs:{"for-id":e.$id("duration-units"),label:e.$str("duration_units_label","totara_api",e.ariaLabel),hidden:!0}}),e._v(" "),i("Select",{attrs:{id:e.$id("duration-units"),options:e.unitOptions},on:{input:function(t){return e.$emit("input",e.durationInSeconds)},blur:function(t){return e.$emit("blur")}},model:{value:e.durationUnits,callback:function(t){e.durationUnits=t},expression:"durationUnits"}})],1)}),[],!1,null,null,null);c(m),m.options.__hasBlocks={script:!0,template:!0};const _=m.exports},F5L3:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l});const n=tui.require("tui/components/uniform/util"),a=tui.require("totara_api/components/form/Duration");var r=i.n(a);const s=(0,n.createUniformInputWrapper)(r());var o=(0,i("wWJ2").Z)(s,void 0,void 0,!1,null,null,null);o.options.__hasBlocks={script:!0,template:!1};const l=o.exports},Iw6L:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>y});var n=i("YLyP"),a=i.n(n),r=i("IpiT"),s=i.n(r),o=i("eHBv"),l=i.n(o),d=i("2XTD"),u=i.n(d),c=i("ijCJ"),m=i.n(c),_=i("p202"),p=i("CbJx"),v=i.n(p),k=i("QD8Q"),g=i.n(k);const f={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"totara_api_create_client"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"totara_api_client_input"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"client"},name:{kind:"Name",value:"totara_api_create_client"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"PLAIN"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"HTML"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"oauth2_client_providers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"client_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"client_secret"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"service_account"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"is_valid"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"user"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"fullname"},arguments:[],directives:[]}]}}]}}]}}]}}]};var h=i("U26W");const N={components:{ActionLink:a(),Button:s(),ButtonGroup:l(),FormRow:u(),Layout:m(),FormText:_.FormText,Uniform:_.Uniform,FormTextarea:_.FormTextarea,FormCheckbox:_.FormCheckbox,FormTagList:v(),MiniProfileCard:g()},props:{tenantId:Number,tenantSuspended:Boolean},apollo:{availableUsers:{query:h.Z,fetchPolicy:"network-only",variables(){return{input:{tenant_id:this.tenantId,pattern:this.searchPattern}}},update:({result:{users:e}})=>e}},data(){return{initialValues:{name:"",description:"",serviceAccount:null,status:!this.tenantSuspended},formValues:null,isAdding:!1,searchPattern:"",availableUsers:[]}},computed:{users(){const e=this.availableUsers.map((({id:e,fullname:t,card_display:i})=>({id:e,text:t,card_display:i})));return this.formValues&&this.formValues.serviceAccount?e.filter((({id:e})=>parseInt(e)!=this.formValues.serviceAccount.id)):e}},methods:{async createClient(e){this.isAdding=!0;try{const{data:{client:t}}=await this.$apollo.mutate({mutation:f,variables:{input:{name:e.name,description:e.description,tenant_id:this.tenantId,status:e.status,user_id:e.serviceAccount.id}}});document.location.href=this.getClientsPageUrl({add_success:1,expand_client:t.id}),window.addEventListener("pageshow",this.resetIsAdding)}catch(e){throw this.isAdding=!1,e}},getClientsPageUrl(e){return e={...e},this.tenantId&&(e.tenant_id=this.tenantId),this.$url("/totara/api/client/",e)},resetIsAdding(e){e.persisted&&(window.removeEventListener("pageshow",this.resetIsAdding),this.isAdding=!1)}}},S=function(e){e.options.__langStrings={totara_api:["add_client","description","required_fields","status","status_enabled","service_account","service_account_help","service_account_placeholder"],core:["add","cancel","name"]}};var b=(0,i("wWJ2").Z)(N,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Layout",{staticClass:"tui-totara_api-addClient",attrs:{title:e.$str("add_client","totara_api")},scopedSlots:e._u([{key:"content",fn:function(){return[i("Uniform",{ref:"form",attrs:{"initial-values":e.initialValues},on:{change:function(t){e.formValues=t},submit:e.createClient}},[i("FormRow",{attrs:{"aria-hidden":"true",vertical:!0}},[i("span",{staticClass:"tui-totara_api-addClient__requiredStar"},[e._v(" * ")]),e._v("\n        "+e._s(e.$str("required_fields","totara_api"))+"\n      ")]),e._v(" "),i("FormRow",{attrs:{label:e.$str("name","core"),required:""}},[i("FormText",{attrs:{name:"name",validations:function(e){return[e.required()]},maxlength:75}})],1),e._v(" "),i("FormRow",{attrs:{label:e.$str("description","totara_api")}},[i("FormTextarea",{attrs:{name:"description",maxlength:1024,rows:8}})],1),e._v(" "),i("FormRow",{attrs:{label:e.$str("service_account","totara_api"),required:"",helpmsg:e.$str("service_account_help","totara_api")}},[i("FormTagList",{attrs:{name:"serviceAccount",validations:function(e){return[e.required()]},items:e.users,filter:e.searchPattern,"input-placeholder":e.$str("service_account_placeholder","totara_api"),"label-name":e.$str("service_account","totara_api"),"single-select":"","close-on-click":""},on:{filter:function(t){e.searchPattern=t}},scopedSlots:e._u([e.$apollo.loading?null:{key:"item",fn:function(e){var t=e.item.card_display;return[i("MiniProfileCard",{attrs:{"no-padding":!0,"no-border":!0,display:t,"read-only":!0}})]}}],null,!0)})],1),e._v(" "),i("FormRow",{attrs:{label:e.$str("status","totara_api")}},[i("FormCheckbox",{attrs:{id:e.$id("status"),name:"status",disabled:e.tenantSuspended}},[e._v("\n          "+e._s(e.$str("status_enabled","totara_api"))+"\n        ")])],1),e._v(" "),i("FormRow",[i("ButtonGroup",[i("Button",{attrs:{styleclass:{primary:"true"},text:e.$str("add","core"),loading:e.isAdding,type:"submit"}}),e._v(" "),i("ActionLink",{attrs:{disabled:e.isAdding,href:e.getClientsPageUrl(),text:e.$str("cancel","core")}})],1)],1)],1)]},proxy:!0}])})}),[],!1,null,null,null);S(b),b.options.__hasBlocks={script:!0,template:!0};const y=b.exports},"68hr":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>T});var n=i("YLyP"),a=i.n(n);const r=tui.require("tui/components/collapsible/Collapsible");var s=i.n(r);const o=tui.require("tui/components/modal/ConfirmationModal");var l=i.n(o);const d=tui.require("tui/components/icons/Invalid");var u=i.n(d);const c=tui.require("tui/components/form/Form");var m=i.n(c),_=i("2XTD"),p=i.n(_),v=i("ijCJ"),k=i.n(v);const g=tui.require("totara_api/components/api_client/ClientActions");var f=i.n(g);const h=tui.require("tui/components/lozenge/Lozenge");var N=i.n(h);const S=tui.require("tui/notifications"),b=tui.require("tui/immutable"),y=tui.require("tui/components/form/InputGroup");var F=i.n(y);const $=tui.require("tui/components/form/InputGroupInput");var w=i.n($);const x=tui.require("tui/components/form/InputGroupButton");var D=i.n(x);const E={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"totara_api_clients"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"totara_api_clients_input"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"clients"},name:{kind:"Name",value:"totara_api_clients"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"items"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"PLAIN"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"service_account"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"fullname"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"is_valid"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"HTML"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"oauth2_client_providers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"client_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"client_secret"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"total"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"next_cursor"},arguments:[],directives:[]}]}}]}}]},C={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"totara_api_delete_client"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"core_id"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"result"},name:{kind:"Name",value:"totara_api_delete_client"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[]}]}}]},L={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"totara_api_set_client_status"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"core_id"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"status"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"result"},name:{kind:"Name",value:"totara_api_set_client_status"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"status"},value:{kind:"Variable",name:{kind:"Name",value:"status"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]}]}}]}}]},R={components:{ActionLink:a(),Collapsible:s(),ConfirmationModal:l(),FormRow:p(),Form:m(),Layout:k(),ClientActions:f(),Lozenge:N(),Invalid:u(),InputGroup:F(),InputGroupInput:w(),InputGroupButton:D()},props:{tenantId:Number,tenantSuspended:Boolean},data:()=>({clients:[],deleteModalOpen:!1,deleting:!1,expanded:{},targetClient:{},urlParams:{},showSecret:{}}),computed:{hasNoRecords(){return 0===this.clients.length}},apollo:{clients:{query:E,variables(){return{input:{tenant_id:this.tenantId}}},update:({clients:{items:e}})=>e}},mounted(){const e=window.location.search;this.urlParams=new URLSearchParams(e);const t=this.urlParams.get("expand_client");t&&(this.expanded[t]=!0,this.urlParams.get("add_success")?((0,S.notify)({message:this.$str("client_added","totara_api")}),this.urlParams.delete("add_success")):this.urlParams.get("edit_success")&&((0,S.notify)({message:this.$str("changes_saved","totara_api")}),this.urlParams.delete("edit_success")),this.clearURLParams())},methods:{handleCollapsibleChange(e,t){this.expanded={...this.expanded,[t]:e}},openDeleteModal(e){this.targetClient=e,this.deleteModalOpen=!0},async deleteClient(){if(this.deleteModalOpen&&this.targetClient)try{this.deleting=!0;const{data:{result:e}}=await this.$apollo.mutate({mutation:C,variables:{id:this.targetClient.id},update:e=>{const t={input:{tenant_id:this.tenantId}};let i=e.readQuery({query:E,variables:t});i=(0,b.produce)(i,(e=>{const t=[...e.clients.items];e.clients.items=t.filter((e=>e.id!==this.targetClient.id))})),e.writeQuery({query:E,variables:t,data:i})}});e&&(0,S.notify)({type:"success",message:this.$str("delete_success","totara_api")})}finally{this.deleteModalOpen=!1,this.deleting=!1}},async setClientStatus(e,t){const{data:{result:i}}=await this.$apollo.mutate({mutation:L,variables:{id:e.id,status:t}});i&&(0,S.notify)({type:"success",message:this.$str(t?"enable_client_success":"disable_client_success","totara_api")})},clearURLParams(){const e=this.tenantId?{tenant_id:this.tenantId}:{};window.history.replaceState(null,null,this.$url("/totara/api/client/",e))},getAddClientPageUrl(){let e={};return this.tenantId&&(e.tenant_id=this.tenantId),this.$url("/totara/api/client/add.php",e)},getUserProfileUrl(e){return this.$url("/user/profile.php",{id:e})},toggleSecretVisibility(e){this.$set(this.showSecret,e,!this.showSecret[e])},showHideText(e){return this.showSecret[e]?this.$str("hide","totara_api"):this.$str("show","totara_api")}}},I=function(e){e.options.__langStrings={core:["delete"],totara_api:["add_client","changes_saved","client_added","client_details","client_id","client_secret","client_name_disabled","delete_confirm_body","delete_confirm_title","delete_modal_title","delete_success","disable_client_error","disable_client_success","enable_client_error","enable_client_success","hide","invalid_user","no_record_found","show","status","status_enabled","status_disabled","service_account","service_account_invalid"]}};var V=(0,i("wWJ2").Z)(R,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Layout",{staticClass:"tui-totara_api-clients",attrs:{title:e.$str("client_details","totara_api"),loading:e.$apollo.loading},scopedSlots:e._u([{key:"header-buttons",fn:function(){return[i("ActionLink",{attrs:{href:e.getAddClientPageUrl(),text:e.$str("add_client","totara_api")}})]},proxy:!0},{key:"modals",fn:function(){return[i("ConfirmationModal",{attrs:{open:e.deleteModalOpen,title:e.$str("delete_modal_title","totara_api"),"confirm-button-text":e.$str("delete","core"),loading:e.deleting},on:{confirm:e.deleteClient,cancel:function(t){e.deleteModalOpen=!1}}},[[i("p",[e._v(e._s(e.$str("delete_confirm_title","totara_api")))]),e._v(" "),i("p",{staticClass:"tui-totara_api-clients__deleteBody"},[e._v("\n          "+e._s(e.$str("delete_confirm_body","totara_api",e.targetClient.name))+"\n        ")])]],2)]},proxy:!0},e.$apollo.loading?null:{key:"content",fn:function(){return[e.hasNoRecords?[i("p",[e._v(e._s(e.$str("no_record_found","totara_api")))])]:e._l(e.clients,(function(t){return i("Collapsible",{key:t.id,staticClass:"tui-totara_api-clients__client",attrs:{label:t.status?t.name:e.$str("client_name_disabled","totara_api",t.name),value:e.expanded[t.id]},on:{input:function(i){return e.handleCollapsibleChange(i,t.id)}},scopedSlots:e._u([{key:"collapsible-side-content",fn:function(){return[t.service_account.is_valid?e._e():i("Invalid",{staticClass:"tui-totara_api-clients__client--invalid",attrs:{alt:e.$str("service_account_invalid","totara_api",t.name)}}),e._v(" "),i("ClientActions",{attrs:{"client-name":t.name,"client-status-enabled":t.status,"client-id":t.id,"tenant-id":e.tenantId,"tenant-suspended":e.tenantSuspended},on:{"delete-api-client":function(i){return e.openDeleteModal(t)},"disable-api-client":function(i){return e.setClientStatus(t,!1)},"enable-api-client":function(i){return e.setClientStatus(t,!0)}}})]},proxy:!0}],null,!0)},[e._v(" "),i("Form",{staticClass:"tui-totara_api-clients__form"},[t.description?i("FormRow",{staticClass:"tui-totara_api-clients__formDesc",attrs:{vertical:!0},domProps:{innerHTML:e._s(t.description)}}):e._e(),e._v(" "),t.oauth2_client_providers[0]?[i("FormRow",{attrs:{label:e.$str("client_id","totara_api")}},[i("span",{staticClass:"tui-totara_api-clients__monospaceFont"},[e._v("\n                "+e._s(t.oauth2_client_providers[0].client_id)+"\n              ")])]),e._v(" "),i("FormRow",{attrs:{label:e.$str("client_secret","totara_api")},scopedSlots:e._u([{key:"default",fn:function(n){var a=n.id,r=n.labelId;return[i("InputGroup",{attrs:{"aria-labelledby":r}},[[i("InputGroupInput",{attrs:{id:a,monospace:!0,readonly:"",type:e.showSecret[t.id]?"text":"password",value:t.oauth2_client_providers[0].client_secret}}),e._v(" "),i("InputGroupButton",{staticClass:"tui-totara_api-clients__inputGroupBtn",attrs:{"aria-controls":a,text:e.showHideText(t.id)},on:{click:function(i){return e.toggleSecretVisibility(t.id)}}})]],2)]}}],null,!0)}),e._v(" "),i("FormRow",{attrs:{label:e.$str("service_account","totara_api")}},[t.service_account.user?i("a",{staticClass:"tui-totara_api-clients__serviceaccount",attrs:{href:e.getUserProfileUrl(t.service_account.user.id)}},[e._v("\n                "+e._s(t.service_account.user.fullname)+"\n              ")]):e._e(),e._v(" "),t.service_account.is_valid?e._e():i("Lozenge",{attrs:{text:e.$str("invalid_user","totara_api"),type:"warning"}})],1),e._v(" "),i("FormRow",{attrs:{label:e.$str("status","totara_api")}},[i("span",[e._v("\n                "+e._s(t.status?e.$str("status_enabled","totara_api"):e.$str("status_disabled","totara_api"))+"\n              ")])])]:e._e()],2)],1)}))]},proxy:!0}],null,!0)})}),[],!1,null,null,null);I(V),V.options.__hasBlocks={script:!0,template:!0};const T=V.exports},yv7m:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>w});var n=i("YQTe"),a=i.n(n),r=i("YLyP"),s=i.n(r),o=i("IpiT"),l=i.n(o),d=i("eHBv"),u=i.n(d),c=i("2XTD"),m=i.n(c),_=i("ijCJ"),p=i.n(_),v=i("p202"),k=i("CbJx"),g=i.n(k),f=i("QD8Q"),h=i.n(f);const N={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"totara_api_update_client"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"totara_api_update_client_input"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"result"},name:{kind:"Name",value:"totara_api_update_client"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"service_account"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"is_valid"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"user"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"fullname"},arguments:[],directives:[]}]}}]}}]}}]}}]};var S=i("U26W");const b=tui.require("totara_api/service_account"),y={components:{Loader:a(),ActionLink:s(),Button:l(),ButtonGroup:u(),FormRow:m(),Layout:p(),FormText:v.FormText,Uniform:v.Uniform,FormTextarea:v.FormTextarea,FormCheckbox:v.FormCheckbox,FormTagList:g(),MiniProfileCard:h()},props:{clientId:{required:!0,type:Number},tenantSuspended:Boolean,tenantId:Number},data:()=>({formValues:null,client:{},isSaving:!1,initialValues:null,searchPattern:"",availableUsers:[]}),computed:{loading(){return Boolean(!this.initialValues)},users(){const e=this.availableUsers.map((({id:e,fullname:t,card_display:i})=>({id:e,text:t,card_display:i,isValid:!0})));return this.formValues&&this.formValues.serviceAccount?e.filter((({id:e})=>parseInt(e)!=this.formValues.serviceAccount.id)):e}},apollo:{client:{query:{kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"totara_api_client_for_editing"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"core_id"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"result"},name:{kind:"Name",value:"totara_api_client"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"client"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"RAW"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"service_account"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"fullname"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"is_valid"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"RAW"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tenant_id"},arguments:[],directives:[]}]}}]}}]}}]},variables(){return{id:this.clientId}},update:({result:{client:e}})=>e,result({data:e}){this.initialValues={name:e.result.client.name,description:e.result.client.description,status:e.result.client.status,serviceAccount:e.result.client.service_account?e.result.client.service_account.user?{id:e.result.client.service_account.user.id,text:e.result.client.service_account.user.fullname,isValid:e.result.client.service_account.is_valid,status:e.result.client.service_account.status}:{id:-1,text:this.$str("unknownuser","core"),isValid:e.result.client.service_account.is_valid,status:e.result.client.service_account.status}:{id:-1,text:this.$str("unknownuser","core"),isValid:!1,status:null}},this.$nextTick((()=>{this.$refs.form.touch("serviceAccount")}))}},availableUsers:{query:S.Z,fetchPolicy:"network-only",variables(){return{input:{tenant_id:this.tenantId,pattern:this.searchPattern}}},update:({result:{users:e}})=>e}},methods:{async editClient(e){this.isSaving=!0;try{await this.$apollo.mutate({mutation:N,variables:{input:{id:this.client.id,name:e.name,description:e.description,status:e.status,user_id:e.serviceAccount.id}}}),document.location.href=this.getClientsPageUrl({edit_success:1,expand_client:this.client.id}),window.addEventListener("pageshow",this.resetIsSaving)}catch(e){throw this.isSaving=!1,e}},getClientsPageUrl(e){return e={...e},this.tenantId&&(e.tenant_id=this.tenantId),this.$url("/totara/api/client/",e)},resetIsSaving(e){e.persisted&&(window.removeEventListener("pageshow",this.resetisSaving),this.isSaving=!1)},isValid(e){if(e&&!e.isValid)return this.$_serviceAccountErrorString(e)},$_serviceAccountErrorString(e){switch(e.status){case b.Status.NO_USER:return this.$str("error_service_account_no_user","totara_api");case b.Status.DELETED:return this.$str("error_service_account_deleted","totara_api");case b.Status.SUSPENDED:return this.$str("error_service_account_suspended","totara_api");case b.Status.GUEST:return this.$str("error_service_account_guest","totara_api");case b.Status.ADMIN:return this.$str("error_service_account_admin","totara_api");case b.Status.WRONG_TENANT:return this.$str("error_service_account_wrong_tenant","totara_api");default:return this.$str("error_service_account_invalid","totara_api")}}}},F=function(e){e.options.__langStrings={totara_api:["description","required_fields","status","status_enabled","edit_client_details","service_account","service_account_help","service_account_placeholder","error_service_account_no_user","error_service_account_deleted","error_service_account_suspended","error_service_account_guest","error_service_account_admin","error_service_account_wrong_tenant","error_service_account_invalid"],core:["name","cancel","error","unknownuser"],totara_core:["save"]}};var $=(0,i("wWJ2").Z)(y,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Layout",{staticClass:"tui-totara_api-editClient",attrs:{title:e.$str("edit_client_details","totara_api")},scopedSlots:e._u([{key:"content",fn:function(){return[e.loading?i("Loader",{attrs:{loading:e.loading}}):i("Uniform",{ref:"form",attrs:{"initial-values":e.initialValues},on:{change:function(t){e.formValues=t},submit:e.editClient}},[i("FormRow",{attrs:{"aria-hidden":"true",vertical:!0}},[i("span",{staticClass:"tui-totara_api-editClient__requiredStar"},[e._v(" * ")]),e._v("\n        "+e._s(e.$str("required_fields","totara_api"))+"\n      ")]),e._v(" "),i("FormRow",{attrs:{label:e.$str("name","core"),required:""}},[i("FormText",{attrs:{name:"name",validations:function(e){return[e.required()]},maxlength:75}})],1),e._v(" "),i("FormRow",{attrs:{label:e.$str("description","totara_api")}},[i("FormTextarea",{attrs:{name:"description",maxlength:1024,rows:8}})],1),e._v(" "),i("FormRow",{attrs:{label:e.$str("service_account","totara_api"),required:"",helpmsg:e.$str("service_account_help","totara_api")}},[i("FormTagList",{attrs:{name:"serviceAccount",validations:function(t){return[e.isValid,t.required()]},items:e.users,filter:e.searchPattern,"input-placeholder":e.$str("service_account_placeholder","totara_api"),"label-name":e.$str("service_account","totara_api"),"single-select":"","close-on-click":""},on:{filter:function(t){e.searchPattern=t}},scopedSlots:e._u([e.$apollo.loading?null:{key:"item",fn:function(e){var t=e.item.card_display;return[i("MiniProfileCard",{attrs:{"no-padding":!0,"no-border":!0,display:t,"read-only":!0}})]}}],null,!0)})],1),e._v(" "),i("FormRow",{attrs:{label:e.$str("status","totara_api")}},[i("FormCheckbox",{attrs:{id:e.$id("status"),name:"status",disabled:e.tenantSuspended}},[e._v("\n          "+e._s(e.$str("status_enabled","totara_api"))+"\n        ")])],1),e._v(" "),i("FormRow",[i("ButtonGroup",[i("Button",{attrs:{styleclass:{primary:"true"},text:e.$str("save","totara_core"),loading:e.isSaving,type:"submit"}}),e._v(" "),i("ActionLink",{attrs:{disabled:e.isSaving,href:e.getClientsPageUrl(),text:e.$str("cancel","core")}})],1)],1)],1)]},proxy:!0}])})}),[],!1,null,null,null);F($),$.options.__hasBlocks={script:!0,template:!0};const w=$.exports},NOhP:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>C});var n=i("YQTe"),a=i.n(n),r=i("YLyP"),s=i.n(r),o=i("IpiT"),l=i.n(o),d=i("eHBv"),u=i.n(d),c=i("2XTD"),m=i.n(c);const _=tui.require("tui/components/form/FormRowDefaults");var p=i.n(_);const v=tui.require("tui/components/form/FormRowDetails");var k=i.n(v),g=i("ijCJ"),f=i.n(g);const h=tui.require("tui/components/notifications/NotificationBanner");var N=i.n(h),S=i("p202");const b=tui.require("totara_api/components/uniform/FormDuration");var y=i.n(b),F=i("AO2P");const $=tui.require("totara_api/error_response"),w={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"totara_api_update_client_settings"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"totara_api_client_setting_input"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"client_setting"},name:{kind:"Name",value:"totara_api_update_client_settings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"client_rate_limit"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"default_token_expiry_time"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"response_debug"},arguments:[],directives:[]}]}}]}}]},x={components:{Loader:a(),ActionLink:s(),Button:l(),ButtonGroup:u(),FormDuration:y(),FormRow:m(),FormRowDefaults:p(),FormRowDetails:k(),FormSelect:S.FormSelect,Layout:f(),FormNumber:S.FormNumber,Uniform:S.Uniform,NotificationBanner:N()},props:{clientId:{required:!0,type:Number},tenantId:Number},data:()=>({formValues:null,settings:{},isSaving:!1,initialValues:null}),computed:{loading(){return Boolean(!this.initialValues)},clientRateLimitExceedsGlobalSettings(){return!this.loading&&this.initialValues.clientRateLimit>this.settings.global_settings.client_rate_limit},errorResponseLevelOptions(){return[{id:null,label:this.defaultErrorResponseLevelString},{id:$.ErrorResponseLevel.NONE,label:this.getErrorResponseLevelString($.ErrorResponseLevel.NONE)},{id:$.ErrorResponseLevel.NORMAL,label:this.getErrorResponseLevelString($.ErrorResponseLevel.NORMAL)},{id:$.ErrorResponseLevel.DEVELOPER,label:this.getErrorResponseLevelString($.ErrorResponseLevel.DEVELOPER)}]},getDefaultTokenExpirationString(){const e=(0,F.parseSeconds)(this.settings.global_settings.default_token_expiry_time);let t;switch(e.units){case F.Units.WEEKS:t=this.$str("duration_weeks","totara_api");break;case F.Units.DAYS:t=this.$str("duration_days","totara_api");break;case F.Units.HOURS:t=this.$str("duration_hours","totara_api");break;case F.Units.MINUTES:t=this.$str("duration_minutes","totara_api");break;case F.Units.SECONDS:t=this.$str("duration_seconds","totara_api")}return{value:e.value,units:t}},defaultErrorResponseLevelString(){let e=this.settings.global_settings.response_debug;return this.$str("error_response_level_default","totara_api",this.getErrorResponseLevelString(e))}},apollo:{settings:{query:{kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"totara_api_client_settings"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"client_id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"core_id"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"settings"},name:{kind:"Name",value:"totara_api_client_settings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"client_id"},value:{kind:"Variable",name:{kind:"Name",value:"client_id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"client_settings"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"client_rate_limit"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"default_token_expiry_time"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"response_debug"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"global_settings"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"site_rate_limit"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"client_rate_limit"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"max_complexity_cost"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"default_token_expiry_time"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"response_debug"},arguments:[],directives:[]}]}}]}}]}}]},variables(){return{client_id:this.clientId}},update:({settings:e})=>e,result({data:e}){this.initialValues={clientRateLimit:e.settings.client_settings.client_rate_limit,tokenExpiration:e.settings.client_settings.default_token_expiry_time,errorResponse:e.settings.client_settings.response_debug}}}},methods:{async editClientSettings(e){this.isSaving=!0;try{await this.$apollo.mutate({mutation:w,variables:{input:{client_id:this.settings.client_settings.id,client_rate_limit:parseInt(e.clientRateLimit),default_token_expiry_time:parseInt(e.tokenExpiration),response_debug:e.errorResponse}}}),document.location.href=this.getClientsPageUrl({edit_success:1,expand_client:this.settings.client_settings.id}),window.addEventListener("pageshow",this.resetIsSaving)}catch(e){throw this.isSaving=!1,e}},getClientsPageUrl(e){return e={...e},this.tenantId&&(e.tenant_id=this.tenantId),this.$url("/totara/api/client/",e)},resetIsSaving(e){e.persisted&&(window.removeEventListener("pageshow",this.resetisSaving),this.isSaving=!1)},maxDuration(){const e=2147483647;return{validate:t=>t<=e,message:()=>this.$str("error_validate_max_input_duration","totara_api",e)}},minDuration(){return{validate:e=>e>=1,message:()=>this.$str("setting:default_token_expiration_invalid","totara_api")}},getErrorResponseLevelString(e){switch(e){case $.ErrorResponseLevel.NONE:return this.$str("none","totara_api");case $.ErrorResponseLevel.NORMAL:return this.$str("normal","totara_api");case $.ErrorResponseLevel.DEVELOPER:return this.$str("developer","totara_api")}}}},D=function(e){e.options.__langStrings={totara_api:["edit_client_settings","required_fields","client_rate_limit","client_rate_limit_at_site_level","client_rate_limit_desc","error_response_desc_1","error_response_desc_2","error_response_level_default","none","normal","developer","error_validate_max_input_duration","token_expiration","token_expiration_default","token_expiration_desc_1","token_expiration_desc_2","warning_client_rate_limit","duration_seconds","duration_minutes","duration_hours","duration_days","duration_weeks","error_response","setting:default_token_expiration_invalid"],core:["cancel"],totara_core:["save"]}};var E=(0,i("wWJ2").Z)(x,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Layout",{staticClass:"tui-totara_api-editClientSettings",attrs:{title:e.$str("edit_client_settings","totara_api")},scopedSlots:e._u([e.clientRateLimitExceedsGlobalSettings?{key:"feedback-banner",fn:function(){return[i("NotificationBanner",{attrs:{type:"warning",message:e.$str("warning_client_rate_limit","totara_api")}})]},proxy:!0}:null,{key:"content",fn:function(){return[e.loading?i("Loader",{attrs:{loading:e.loading}}):i("Uniform",{ref:"form",attrs:{"initial-values":e.initialValues},on:{change:function(t){e.formValues=t},submit:e.editClientSettings}},[i("FormRow",{staticClass:"tui-totara_api-editClientSettings__required",attrs:{"aria-hidden":"true",vertical:!0}},[i("span",{staticClass:"tui-totara_api-editClientSettings__requiredStar"},[e._v("\n          *\n        ")]),e._v("\n        "+e._s(e.$str("required_fields","totara_api"))+"\n      ")]),e._v(" "),i("FormRow",{attrs:{label:e.$str("client_rate_limit","totara_api"),required:"","aria-describedby":e.$id("client-rate-limit-default")+" "+e.$id("client-rate-limit-details")}},[i("FormNumber",{attrs:{name:"clientRateLimit",min:1,max:2147483647,validations:function(e){return[e.required(),e.min(1),e.max(2147483647)]}}}),e._v(" "),i("FormRowDetails",{staticClass:"tui-totara_api-editClientSettings__defaultInfo",attrs:{id:e.$id("client-rate-limit-default")}},[e._v("\n          "+e._s(e.$str("client_rate_limit_at_site_level","totara_api",e.settings.global_settings.client_rate_limit))+"\n        ")]),e._v(" "),i("FormRowDetails",{attrs:{id:e.$id("client-rate-limit-details")}},[e._v("\n          "+e._s(e.$str("client_rate_limit_desc","totara_api"))+"\n        ")])],1),e._v(" "),i("FormRow",{attrs:{label:e.$str("token_expiration","totara_api"),required:"","aria-describedby":e.$id("token-expiration-default")+" "+e.$id("token-expiration-details-1")+" "+e.$id("token-expiration-details-2")}},[i("FormDuration",{attrs:{name:"tokenExpiration","aria-label":e.$str("token_expiration","totara_api"),validations:function(t){return[t.required(),e.minDuration(),e.maxDuration()]}}}),e._v(" "),i("FormRowDefaults",{attrs:{id:e.$id("token-expiration-default")}},[e._v("\n          "+e._s(e.$str("token_expiration_default","totara_api",e.getDefaultTokenExpirationString))+"\n        ")]),e._v(" "),i("FormRowDetails",{attrs:{id:e.$id("token-expiration-details-1")}},[e._v("\n          "+e._s(e.$str("token_expiration_desc_1","totara_api"))+"\n        ")]),e._v(" "),i("FormRowDetails",{attrs:{id:e.$id("token-expiration-details-2")}},[e._v("\n          "+e._s(e.$str("token_expiration_desc_2","totara_api"))+"\n        ")])],1),e._v(" "),i("FormRow",{attrs:{label:e.$str("error_response","totara_api"),required:"","aria-describedby":e.$id("error-response-default")+" "+e.$id("error-response-details-1")+" "+e.$id("error-response-details-2")}},[i("FormSelect",{attrs:{"aria-label":e.$str("error_response","totara_api"),name:"errorResponse",options:e.errorResponseLevelOptions}}),e._v(" "),i("FormRowDefaults",{attrs:{id:e.$id("error-response-default")}},[e._v("\n          "+e._s(e.defaultErrorResponseLevelString)+"\n        ")]),e._v(" "),i("FormRowDetails",{attrs:{id:e.$id("error-response-details-1")}},[e._v("\n          "+e._s(e.$str("error_response_desc_1","totara_api"))+"\n        ")]),e._v(" "),i("FormRowDetails",{attrs:{id:e.$id("error-response-details-2")},domProps:{innerHTML:e._s(e.$str("error_response_desc_2","totara_api"))}})],1),e._v(" "),i("FormRow",[i("ButtonGroup",[i("Button",{attrs:{styleclass:{primary:"true"},text:e.$str("save","totara_core"),loading:e.isSaving,type:"submit"}}),e._v(" "),i("ActionLink",{attrs:{disabled:e.isSaving,href:e.getClientsPageUrl(),text:e.$str("cancel","core")}})],1)],1)],1)]},proxy:!0}],null,!0)})}),[],!1,null,null,null);D(E),E.options.__hasBlocks={script:!0,template:!0};const C=E.exports},IJDg:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Units:()=>n,parseSeconds:()=>r,unitsInSeconds:()=>a});const n={WEEKS:"WEEKS",DAYS:"DAYS",HOURS:"HOURS",MINUTES:"MINUTES",SECONDS:"SECONDS"},a=[{id:n.WEEKS,seconds:604800},{id:n.DAYS,seconds:86400},{id:n.HOURS,seconds:3600},{id:n.MINUTES,seconds:60},{id:n.SECONDS,seconds:1}];function r(e){let t,i;for(let n=0;n<a.length;n++)if(e%a[n].seconds==0)return t=e/a[n].seconds,i=a[n].id,{value:t,units:i}}},pckc:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ErrorResponseLevel:()=>n});const n={NONE:"NONE",NORMAL:"NORMAL",DEVELOPER:"DEVELOPER"}},sK66:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Status:()=>n});const n={NO_USER:"NO_USER",DELETED:"DELETED",SUSPENDED:"SUSPENDED",GUEST:"GUEST",ADMIN:"ADMIN",WRONG_TENANT:"WRONG_TENANT"}},wWJ2:(e,t,i)=>{"use strict";function n(e,t,i,n,a,r,s,o){var l,d="function"==typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=i,d._compiled=!0),n&&(d.functional=!0),r&&(d._scopeId="data-v-"+r),s?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),a&&a.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},d._ssrRegister=l):a&&(l=o?function(){a.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:a),l)if(d.functional){d._injectStyles=l;var u=d.render;d.render=function(e,t){return l.call(t),u(e,t)}}else{var c=d.beforeCreate;d.beforeCreate=c?[].concat(c,l):[l]}return{exports:e,options:d}}i.d(t,{Z:()=>n})},AO2P:e=>{"use strict";e.exports=tui.require("totara_api/duration")},eHBv:e=>{"use strict";e.exports=tui.require("tui/components/buttons/ButtonGroup")},IpiT:e=>{"use strict";e.exports=tui.require("tui/components/buttons/Button")},"2XTD":e=>{"use strict";e.exports=tui.require("tui/components/form/FormRow")},ijCJ:e=>{"use strict";e.exports=tui.require("tui/components/layouts/LayoutOneColumn")},YLyP:e=>{"use strict";e.exports=tui.require("tui/components/links/ActionLink")},YQTe:e=>{"use strict";e.exports=tui.require("tui/components/loading/Loader")},QD8Q:e=>{"use strict";e.exports=tui.require("tui/components/profile/MiniProfileCard")},CbJx:e=>{"use strict";e.exports=tui.require("tui/components/uniform/FormTagList")},p202:e=>{"use strict";e.exports=tui.require("tui/components/uniform")}},t={};function i(n){var a=t[n];if(void 0!==a)return a.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,i),r.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){"use strict";"undefined"!=typeof tui&&tui._bundle.isLoaded("totara_api")?console.warn('[tui bundle] The bundle "totara_api" is already loaded, skipping initialisation.'):(tui._bundle.register("totara_api"),tui._bundle.addModulesFromContext("totara_api",i("YKew")),tui._bundle.addModulesFromContext("totara_api/components",i("KWZD")),tui._bundle.addModulesFromContext("totara_api/pages",i("Yrvf")))}()})();