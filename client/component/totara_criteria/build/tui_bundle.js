(()=>{var e={mInz:(e,t,r)=>{var i={"./achievements/CompetencyAchievementDisplay":"aZ13","./achievements/CompetencyAchievementDisplay.vue":"aZ13","./achievements/CourseAchievementDisplay":"NeGU","./achievements/CourseAchievementDisplay.vue":"NeGU"};function n(e){var t=s(e);return r(t)}function s(e){if(!r.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=s,e.exports=n,n.id="mInz"},aZ13:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>O});var i=r("oMVU"),n=r.n(i),s=r("YLyP"),o=r.n(s);const a=tui.require("tui/components/buttons/Button");var c=r.n(a),u=r("RJ4J"),l=r.n(u),m=r("9Ont"),_=r.n(m);const p=tui.require("tui/components/modal/ConfirmationModal");var d=r.n(p),v=r("MQqf"),h=r.n(v),y=r("olzi"),f=r.n(y),C=r("BDBh"),g=r.n(C);const b=tui.require("tui/notifications"),k={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"totara_competency_create_user_assignments"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"user_id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"core_id"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"competency_ids"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"core_id"}}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"totara_competency_create_user_assignments"},arguments:[{kind:"Argument",name:{kind:"Name",value:"user_id"},value:{kind:"Variable",name:{kind:"Name",value:"user_id"}}},{kind:"Argument",name:{kind:"Name",value:"competency_ids"},value:{kind:"Variable",name:{kind:"Name",value:"competency_ids"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]},x={components:{AchievementLayout:n(),ActionLink:o(),Button:c(),Cell:l(),CheckIcon:_(),ConfirmationModal:d(),ExpandCell:h(),ProgressCircle:f(),Table:g()},props:{achievements:{required:!0,type:Object},type:{required:!0,type:String},userId:{required:!0,type:Number}},data:function(){return{modalOpen:!1}},computed:{achievedCompetencies(){return this.achievements.items.reduce(((e,t)=>t.value&&t.value.proficient?e+=1:e),0)},criteriaComplete(){return this.isValid&&this.numberOfRequiredCompetencies>0&&this.achievedCompetencies>=this.numberOfRequiredCompetencies},criteriaHeading(){return"otherCompetency"===this.type?this.$str("achieve_proficiency_in_other_competencies","totara_criteria"):this.$str("achieve_proficiency_in_child_competencies","totara_criteria")},noCompetenciesString(){return"otherCompetency"===this.type?this.$str("error_no_competencies","criteria_othercompetency"):this.$str("error_no_children","criteria_childcompetency")},numberOfRequiredCompetencies(){return 1===this.achievements.aggregation_method?this.achievements.items.length:this.achievements.required_items},isValid(){return this.achievements.is_valid}},methods:{assignCompetency(e){this.$apollo.mutate({mutation:k,variables:{competency_ids:[e.id],user_id:this.userId}}).then((({data:e})=>{e&&e.totara_competency_create_user_assignments&&(e.totara_competency_create_user_assignments.length>0?this.$emit("self-assigned"):this.triggerErrorNotification(this.$str("error_competency_assignment","totara_criteria")))})).catch((e=>{console.error(e),this.triggerErrorNotification(this.$str("error_competency_assignment","totara_criteria"))})).finally((()=>this.closeModal()))},triggerErrorNotification(e){(0,b.notify)({message:e,type:"error"})},showModal(){this.modalOpen=!0},closeModal(){this.modalOpen=!1}}},N=function(e){e.options.__langStrings={criteria_childcompetency:["error_no_children"],criteria_othercompetency:["error_no_competencies"],totara_criteria:["achieve_proficiency_in_child_competencies","achieve_proficiency_in_other_competencies","assign_competency","competencies","complete","completion","confirm_assign_competency_body_by_other","confirm_assign_competency_body_by_self","confirm_assign_competency_title","error_competency_assignment","network_error","not_available","not_complete","achievement_level","self_assign_competency","view_competency"]}};var A=(0,r("wWJ2").Z)(x,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"tui-criteriaCompetencyAchievement"},[r("AchievementLayout",{scopedSlots:e._u([{key:"left",fn:function(){return[r("div",{staticClass:"tui-criteriaCompetencyAchievement__goal"},[r("h5",{staticClass:"tui-criteriaCompetencyAchievement__title"},[e._v("\n          "+e._s(e.criteriaHeading)+"\n        ")]),e._v(" "),r("ProgressCircle",{attrs:{complete:e.criteriaComplete,completed:e.criteriaComplete?e.numberOfRequiredCompetencies:e.achievedCompetencies,target:e.numberOfRequiredCompetencies}})],1)]},proxy:!0},{key:"right",fn:function(){return[r("Table",{attrs:{data:e.achievements.items,"expandable-rows":!0,"no-items-text":e.noCompetenciesString},scopedSlots:e._u([{key:"row",fn:function(t){var i=t.row,n=t.expand,s=t.expandState;return[r("ExpandCell",{attrs:{"aria-label":i.competency.fullname,size:"1","expand-state":s},on:{click:function(e){return n()}}}),e._v(" "),r("Cell",{attrs:{size:"9","column-header":e.$str("competencies","totara_criteria")}},[e._v("\n            "+e._s(i.competency.fullname)+"\n          ")]),e._v(" "),r("Cell",{class:"tui-criteriaCompetencyAchievement__level",attrs:{size:"3","column-header":e.$str("achievement_level","totara_criteria")}},[i.value?[e._v("\n              "+e._s(i.value.name)+"\n            ")]:[r("span",{staticClass:"tui-criteriaCompetencyAchievement__level-notAvailable"},[e._v("\n                "+e._s(e.$str("not_available","totara_criteria"))+"\n              ")])]],2),e._v(" "),r("Cell",{attrs:{size:"3","column-header":e.$str("completion","totara_criteria"),align:"end"}},[i.value&&i.value.proficient?r("div",{staticClass:"tui-criteriaCompetencyAchievement__completion-complete"},[r("CheckIcon",{attrs:{size:"200"}}),e._v("\n              "+e._s(e.$str("complete","totara_criteria"))+"\n            ")],1):r("div",{staticClass:"tui-criteriaCompetencyAchievement__completion-notComplete"},[e._v("\n              "+e._s(e.$str("not_complete","totara_criteria"))+"\n            ")])])]}},{key:"expand-content",fn:function(t){var i=t.row;return[r("div",{staticClass:"tui-criteriaCompetencyAchievement__summary"},[r("h6",{staticClass:"tui-criteriaCompetencyAchievement__summary-header"},[e._v("\n              "+e._s(i.competency.fullname)+"\n            ")]),e._v(" "),r("div",{staticClass:"tui-criteriaCompetencyAchievement__summary-body",domProps:{innerHTML:e._s(i.competency.description)}}),e._v(" "),i.assigned?r("ActionLink",{class:"tui-criteriaCompetencyAchievement__summary-button",attrs:{href:e.$url("/totara/competency/profile/details/index.php",{competency_id:i.competency.id,user_id:e.userId}),text:e.$str("view_competency","totara_criteria"),styleclass:{primary:!0,small:!0}}}):i.self_assignable?r("div",[r("Button",{class:"tui-criteriaCompetencyAchievement__summary-button",attrs:{text:e.$str(e.achievements.current_user?"self_assign_competency":"assign_competency","totara_criteria"),styleclass:{primary:!0,small:!0}},on:{click:function(t){return e.showModal(i.competency)}}})],1):e._e()],1),e._v(" "),r("ConfirmationModal",{attrs:{open:e.modalOpen,title:e.$str("confirm_assign_competency_title","totara_criteria")},on:{confirm:function(t){return e.assignCompetency(i.competency)},cancel:e.closeModal}},[e._v("\n            "+e._s(e.$str(e.achievements.current_user?"confirm_assign_competency_body_by_self":"confirm_assign_competency_body_by_other","totara_criteria",i.competency.fullname))+"\n          ")])]}}])})]},proxy:!0}])})],1)}),[],!1,null,null,null);N(A),A.options.__hasBlocks={script:!0,template:!0};const O=A.exports},NeGU:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>k});var i=r("oMVU"),n=r.n(i),s=r("YLyP"),o=r.n(s),a=r("RJ4J"),c=r.n(a),u=r("9Ont"),l=r.n(u),m=r("MQqf"),_=r.n(m);const p=tui.require("tui/components/progress/Progress");var d=r.n(p),v=r("olzi"),h=r.n(v),y=r("BDBh"),f=r.n(y);const C={components:{AchievementLayout:n(),ActionLink:o(),Cell:c(),CheckIcon:l(),ExpandCell:_(),Progress:d(),ProgressCircle:h(),Table:f()},props:{achievements:{required:!0,type:Object},displayed:Boolean},computed:{criteriaFulfilled(){return this.isValid&&this.targetNumberOfCourses>0&&this.completedNumberOfCourses>=this.targetNumberOfCourses},numberOfCourses(){return this.achievements.items?this.achievements.items.length:0},completedNumberOfCourses(){let e=0;return this.numberOfCourses?(this.achievements.items.forEach((t=>{t.course&&100===t.course.progress&&e++})),e):e},targetNumberOfCourses(){return 1===this.achievements.aggregation_method?this.numberOfCourses:this.achievements.required_items},isValid(){return this.achievements.is_valid}},methods:{getCourseName(e){return e.course?e.course.fullname:this.$str("hidden_course","totara_criteria")},hasProgress:e=>e.course&&e.course.progress>0,getProgressSummary(e){return e.course&&e.course.progress_summary?e.course.progress_summary:this.$str("not_available","totara_criteria")},isComplete:e=>e.course&&100===e.course.progress}},g=function(e){e.options.__langStrings={totara_criteria:["complete","completion","complete_courses","courses","go_to_course","hidden_course","no_courses","not_available","not_complete","progress"]}};var b=(0,r("wWJ2").Z)(C,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"tui-criteriaCourseAchievement"},[r("AchievementLayout",{scopedSlots:e._u([{key:"left",fn:function(){return[r("div",{staticClass:"tui-criteriaCourseAchievement__goal"},[r("h4",{staticClass:"tui-criteriaCourseAchievement__title"},[e._v("\n          "+e._s(e.$str("complete_courses","totara_criteria"))+"\n        ")]),e._v(" "),r("ProgressCircle",{attrs:{complete:e.criteriaFulfilled,completed:e.completedNumberOfCourses>=e.targetNumberOfCourses?e.targetNumberOfCourses:e.completedNumberOfCourses,target:e.targetNumberOfCourses}})],1)]},proxy:!0},{key:"right",fn:function(){return[r("Table",{attrs:{data:e.achievements.items,"expandable-rows":!0,"no-items-text":e.$str("no_courses","totara_criteria")},scopedSlots:e._u([{key:"row",fn:function(t){var i=t.row,n=t.expand,s=t.expandState;return[r("ExpandCell",{attrs:{"aria-label":e.getCourseName(i),"expand-state":s},on:{click:function(e){return n()}}}),e._v(" "),r("Cell",{attrs:{size:"9","column-header":e.$str("courses","totara_criteria")}},[e._v("\n            "+e._s(e.getCourseName(i))+"\n          ")]),e._v(" "),r("Cell",{class:"tui-criteriaCourseAchievement__progress",attrs:{size:"3","column-header":e.$str("progress","totara_criteria")}},[e.hasProgress(i)?r("div",{staticClass:"tui-criteriaCourseAchievement__progress-bar"},[e.displayed?r("Progress",{attrs:{value:i.course.progress}}):e._e()],1):r("div",{staticClass:"tui-criteriaCourseAchievement__progress-empty"},[e._v("\n              "+e._s(e.getProgressSummary(i))+"\n            ")])]),e._v(" "),r("Cell",{attrs:{size:"3","column-header":e.$str("completion","totara_criteria"),align:"end"}},[e.isComplete(i)?r("div",{staticClass:"tui-criteriaCourseAchievement__completion-complete"},[r("CheckIcon",{attrs:{size:"200"}}),e._v("\n              "+e._s(e.$str("complete","totara_criteria"))+"\n            ")],1):r("div",{staticClass:"tui-criteriaCourseAchievement__completion-notComplete"},[e._v("\n              "+e._s(e.$str("not_complete","totara_criteria"))+"\n            ")])])]}},{key:"expand-content",fn:function(t){var i=t.row;return[r("div",{staticClass:"tui-criteriaCourseAchievement__summary"},[r("h6",{staticClass:"tui-criteriaCourseAchievement__summary-header"},[e._v("\n              "+e._s(i.course.fullname)+"\n            ")]),e._v(" "),r("div",{staticClass:"tui-criteriaCourseAchievement__summary-body",domProps:{innerHTML:e._s(i.course.description)}}),e._v(" "),r("ActionLink",{class:"tui-criteriaCourseAchievement__summary-button",attrs:{href:i.course.url_view,text:e.$str("go_to_course","totara_criteria"),styleclass:{primary:!0,small:!0}}})],1)]}}])})]},proxy:!0}])})],1)}),[],!1,null,null,null);g(b),b.options.__hasBlocks={script:!0,template:!0};const k=b.exports},wWJ2:(e,t,r)=>{"use strict";function i(e,t,r,i,n,s,o,a){var c,u="function"==typeof e?e.options:e;if(t&&(u.render=t,u.staticRenderFns=r,u._compiled=!0),i&&(u.functional=!0),s&&(u._scopeId="data-v-"+s),o?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},u._ssrRegister=c):n&&(c=a?function(){n.call(this,(u.functional?this.parent:this).$root.$options.shadowRoot)}:n),c)if(u.functional){u._injectStyles=c;var l=u.render;u.render=function(e,t){return c.call(t),l(e,t)}}else{var m=u.beforeCreate;u.beforeCreate=m?[].concat(m,c):[c]}return{exports:e,options:u}}r.d(t,{Z:()=>i})},oMVU:e=>{"use strict";e.exports=tui.require("totara_competency/components/achievements/AchievementLayout")},olzi:e=>{"use strict";e.exports=tui.require("totara_competency/components/achievements/ProgressCircle")},RJ4J:e=>{"use strict";e.exports=tui.require("tui/components/datatable/Cell")},MQqf:e=>{"use strict";e.exports=tui.require("tui/components/datatable/ExpandCell")},BDBh:e=>{"use strict";e.exports=tui.require("tui/components/datatable/Table")},"9Ont":e=>{"use strict";e.exports=tui.require("tui/components/icons/CheckSuccess")},YLyP:e=>{"use strict";e.exports=tui.require("tui/components/links/ActionLink")}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){"use strict";"undefined"!=typeof tui&&tui._bundle.isLoaded("totara_criteria")?console.warn('[tui bundle] The bundle "totara_criteria" is already loaded, skipping initialisation.'):(tui._bundle.register("totara_criteria"),tui._bundle.addModulesFromContext("totara_criteria/components",r("mInz")))}()})();