(()=>{var e={JVcY:(e,t,n)=>{var i={"./adder/EvidenceAdder":"vOOZ","./adder/EvidenceAdder.vue":"vOOZ","./performelement_linked_review/AdminView":"tjkP","./performelement_linked_review/AdminView.vue":"tjkP","./performelement_linked_review/ParticipantContent":"otDT","./performelement_linked_review/ParticipantContent.vue":"otDT","./performelement_linked_review/ParticipantContentPicker":"uhT0","./performelement_linked_review/ParticipantContentPicker.vue":"uhT0"};function a(e){var t=r(e);return n(t)}function r(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=r,e.exports=a,a.id="JVcY"},vOOZ:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>$});const i=tui.require("tui/components/adder/Adder");var a=n.n(i);const r=tui.require("tui/components/datatable/Cell");var d=n.n(r);const l=tui.require("tui/components/filters/FilterBar");var s=n.n(l);const c=tui.require("tui/components/datatable/HeaderCell");var o=n.n(c);const u=tui.require("tui/components/filters/SearchFilter");var _=n.n(u);const v=tui.require("tui/components/filters/SelectFilter");var p=n.n(v);const m=tui.require("tui/components/datatable/SelectTable");var h=n.n(m);const f={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"totara_evidence_user_evidence_items"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"totara_evidence_user_evidence_items_input"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"evidence"},name:{kind:"Name",value:"totara_evidence_user_evidence_items"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"items"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"created_at"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"DATELONG"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"fields"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"content"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"total"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"next_cursor"},arguments:[],directives:[]}]}}]}}]},k={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"totara_evidence_user_evidence_types"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"totara_evidence_user_evidence_types_input"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"types"},name:{kind:"Name",value:"totara_evidence_user_evidence_types"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"items"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}]}}]},y=tui.require("tui/util"),b={components:{Adder:a(),Cell:d(),FilterBar:s(),HeaderCell:o(),SearchFilter:_(),SelectFilter:p(),SelectTable:h()},props:{existingItems:{type:Array,default:()=>[]},open:Boolean,showLoadingBtn:Boolean,userId:Number},data:()=>({evidence:null,evidenceSelectedItems:[],evidenceTypes:[],selectedEvidenceTypeId:0,filters:{search:"",typeId:""},nextPage:!1,skipQueries:!0,searchDebounce:""}),computed:{evidenceTypeFilterOptions(){return this.mapFilterOptions(this.evidenceTypes)}},watch:{open(){this.open?(this.searchDebounce="",this.skipQueries=!1):this.skipQueries=!0},searchDebounce(e){this.updateFilterDebounced(e)},selectedEvidenceTypeId(e){this.filters.typeId=e}},created(){this.$apollo.addSmartQuery("evidence",{query:f,skip(){return this.skipQueries},variables(){return{input:{filters:{search:this.filters.search,type_id:this.filters.typeId},user_id:this.userId}}},update({evidence:e}){return this.nextPage=!!e.next_cursor&&e.next_cursor,e}}),this.$apollo.addSmartQuery("selectedEvidence",{query:f,skip(){return this.skipQueries},variables(){return{input:{filters:{ids:[]},user_id:this.userId}}},update({evidence:e}){return this.evidenceSelectedItems=e.items,e}}),this.$apollo.addSmartQuery("evidenceTypes",{query:k,skip(){return this.skipQueries},variables(){return{input:{user_id:this.userId}}},update:({types:e})=>e.items})},methods:{async loadMoreItems(){if(this.nextPage)try{this.$apollo.queries.evidence.fetchMore({variables:{input:{cursor:this.nextPage,filters:{search:this.filters.search,type_id:this.filters.typeId},user_id:this.userId}},updateQuery:(e,{fetchMoreResult:t})=>{const n=e.evidence,i=t.evidence;return{evidence:{items:n.items.concat(i.items),next_cursor:i.next_cursor}}}})}catch(e){console.error(e)}},async updateSelectedItems(e){const t=e.length;try{await this.$apollo.queries.selectedEvidence.refetch({input:{filters:{ids:e},result_size:t,user_id:this.userId}})}catch(e){console.error(e)}return this.evidenceSelectedItems},async closeWithData(e){let t;this.$emit("add-button-clicked");try{t=await this.updateSelectedItems(e),this.selectedEvidenceTypeId=0}catch(e){return void console.error(e)}this.$emit("added",{ids:e,data:t})},cancelAdder(){this.selectedEvidenceTypeId=0,this.$emit("cancel")},mapFilterOptions(e){let t=e;return t=t.map((e=>({id:e.id,label:e.name}))),t.unshift({id:0,label:this.$str("all","core")}),t},updateFilterDebounced:(0,y.debounce)((function(e){this.filters.search=e}),500)}},g=function(e){e.options.__langStrings={core:["all"],totara_core:["search"],totara_evidence:["date_created","evidence_type","filter_evidence","filter_evidence_items_search_label","header_evidence","select_evidence"]}};var S=(0,n("wWJ2").Z)(b,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Adder",{attrs:{open:e.open,title:e.$str("select_evidence","totara_evidence"),"existing-items":e.existingItems,loading:e.$apollo.loading,"show-load-more":e.nextPage,"show-loading-btn":e.showLoadingBtn},on:{added:function(t){return e.closeWithData(t)},cancel:function(t){return e.cancelAdder()},"load-more":function(t){return e.loadMoreItems()},"selected-tab-active":function(t){return e.updateSelectedItems(t)}},scopedSlots:e._u([{key:"browse-filters",fn:function(){return[n("FilterBar",{attrs:{"has-top-bar":!1,title:e.$str("filter_evidence","totara_evidence")},scopedSlots:e._u([{key:"filters-left",fn:function(t){var i=t.stacked;return[n("SelectFilter",{attrs:{label:e.$str("evidence_type","totara_evidence"),"show-label":!0,options:e.evidenceTypeFilterOptions,stacked:i},model:{value:e.selectedEvidenceTypeId,callback:function(t){e.selectedEvidenceTypeId=t},expression:"selectedEvidenceTypeId"}})]}},{key:"filters-right",fn:function(t){var i=t.stacked;return[n("SearchFilter",{attrs:{label:e.$str("filter_evidence_items_search_label","totara_evidence"),"show-label":!1,placeholder:e.$str("search","totara_core"),stacked:i},model:{value:e.searchDebounce,callback:function(t){e.searchDebounce=t},expression:"searchDebounce"}})]}}])})]},proxy:!0},{key:"browse-list",fn:function(t){var i=t.disabledItems,a=t.selectedItems,r=t.update;return[n("SelectTable",{attrs:{"large-check-box":!0,"no-label-offset":!0,value:a,data:e.evidence&&e.evidence.items?e.evidence.items:[],"disabled-ids":i,"checkbox-v-align":"center","select-all-enabled":!0,"border-bottom-hidden":!0},on:{input:function(e){return r(e)}},scopedSlots:e._u([{key:"header-row",fn:function(){return[n("HeaderCell",{attrs:{size:"8",valign:"center"}},[e._v("\n          "+e._s(e.$str("header_evidence","totara_evidence"))+"\n        ")]),e._v(" "),n("HeaderCell",{attrs:{size:"4",valign:"center"}},[e._v("\n          "+e._s(e.$str("evidence_type","totara_evidence"))+"\n        ")]),e._v(" "),n("HeaderCell",{attrs:{size:"4",valign:"center"}},[e._v("\n          "+e._s(e.$str("date_created","totara_evidence"))+"\n        ")])]},proxy:!0},{key:"row",fn:function(t){var i=t.row;return[n("Cell",{attrs:{size:"8",valign:"center","column-header":e.$str("header_evidence","totara_evidence")}},[e._v("\n          "+e._s(i.name)+"\n        ")]),e._v(" "),n("Cell",{attrs:{size:"4",valign:"center","column-header":e.$str("evidence_type","totara_evidence")}},[e._v("\n          "+e._s(i.type.name)+"\n        ")]),e._v(" "),n("Cell",{attrs:{"column-header":e.$str("date_created","totara_evidence"),valign:"center",size:"4"}},[e._v("\n          "+e._s(i.created_at)+"\n        ")])]}}],null,!0)})]}},{key:"basket-list",fn:function(t){var i=t.disabledItems,a=t.selectedItems,r=t.update;return[n("SelectTable",{attrs:{"large-check-box":!0,"no-label-offset":!0,value:a,data:e.evidenceSelectedItems,"disabled-ids":i,"checkbox-v-align":"center","border-bottom-hidden":!0,"select-all-enabled":!0},on:{input:function(e){return r(e)}},scopedSlots:e._u([{key:"header-row",fn:function(){return[n("HeaderCell",{attrs:{size:"8",valign:"center"}},[e._v("\n          "+e._s(e.$str("header_evidence","totara_evidence"))+"\n        ")]),e._v(" "),n("HeaderCell",{attrs:{size:"4",valign:"center"}},[e._v("\n          "+e._s(e.$str("evidence_type","totara_evidence"))+"\n        ")]),e._v(" "),n("HeaderCell",{attrs:{size:"4",valign:"center"}},[e._v("\n          "+e._s(e.$str("date_created","totara_evidence"))+"\n        ")])]},proxy:!0},{key:"row",fn:function(t){var i=t.row;return[n("Cell",{attrs:{size:"8",valign:"center","column-header":e.$str("header_evidence","totara_evidence")}},[e._v("\n          "+e._s(i.name)+"\n        ")]),e._v(" "),n("Cell",{attrs:{size:"4",valign:"center","column-header":e.$str("evidence_type","totara_evidence")}},[e._v("\n          "+e._s(i.type.name)+"\n        ")]),e._v(" "),n("Cell",{attrs:{"column-header":e.$str("date_created","totara_evidence"),valign:"center",size:"4"}},[e._v("\n          "+e._s(i.created_at)+"\n        ")])]}}],null,!0)})]}}])})}),[],!1,null,null,null);g(S),S.options.__hasBlocks={script:!0,template:!0};const $=S.exports},tjkP:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});const i=tui.require("totara_evidence/components/performelement_linked_review/ParticipantContent"),a={components:{ParticipantContent:n.n(i)()},data(){return{data:{display_name:"Example evidence",id:0,type:{name:"Evidence type"},content_type:"",created_at:0,fields:[{label:this.$str("admin_placeholder_label_file","totara_evidence"),type:"file",content:JSON.stringify({file_size:12345678,file_name:"filename.pdf",url:"",html:""})},{label:this.$str("admin_placeholder_label_date","totara_evidence"),type:"",content:JSON.stringify({html:this.$str("admin_placeholder_field_date","totara_evidence")})},{label:this.$str("admin_placeholder_label_location","totara_evidence"),type:"",content:JSON.stringify({html:this.$str("admin_placeholder_field_location","totara_evidence")})},{label:this.$str("admin_placeholder_label_menu","totara_evidence"),type:"",content:JSON.stringify({html:this.$str("admin_placeholder_field_menu","totara_evidence")})},{label:this.$str("admin_placeholder_label_text_area","totara_evidence"),type:"",content:JSON.stringify({html:this.$str("admin_placeholder_field_text_area","totara_evidence")})},{label:this.$str("admin_placeholder_label_text_input","totara_evidence"),type:"",content:JSON.stringify({html:this.$str("admin_placeholder_field_text_input","totara_evidence")})},{label:this.$str("admin_placeholder_label_checkbox","totara_evidence"),type:"",content:JSON.stringify({html:this.$str("admin_placeholder_field_checkbox","totara_evidence")})},{label:this.$str("admin_placeholder_label_url","totara_evidence"),type:"",content:JSON.stringify({html:this.$str("admin_placeholder_field_url","totara_evidence")})}]}}}},r=function(e){e.options.__langStrings={totara_evidence:["admin_placeholder_field_checkbox","admin_placeholder_field_date","admin_placeholder_field_location","admin_placeholder_field_menu","admin_placeholder_field_text_area","admin_placeholder_field_text_input","admin_placeholder_field_url","admin_placeholder_label_checkbox","admin_placeholder_label_date","admin_placeholder_label_file","admin_placeholder_label_location","admin_placeholder_label_menu","admin_placeholder_label_text_area","admin_placeholder_label_text_input","admin_placeholder_label_url","admin_placeholder_title","admin_placeholder_type"]}};var d=(0,n("wWJ2").Z)(a,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-linkedReviewAdminViewEvidence"},[n("ParticipantContent",{attrs:{title:e.$str("admin_placeholder_title","totara_evidence"),content:e.data,type:e.$str("admin_placeholder_type","totara_evidence")}})],1)}),[],!1,null,null,null);r(d),d.options.__hasBlocks={script:!0,template:!0};const l=d.exports},otDT:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});const i=tui.require("tui/components/file/FileCard"),a={components:{FileCard:n.n(i)()},props:{content:{type:Object,default:()=>({display_name:"",id:"",type:{id:"0",name:""},content_type:"",created_at:"",fields:[]})}},data(){return{fields:this.content.fields.map((e=>Object.assign({},e,{content:JSON.parse(e.content)})))}}};var r=(0,n("wWJ2").Z)(a,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-linkedReviewViewEvidence"},[n("h3",{staticClass:"tui-linkedReviewViewEvidence__heading"},[e._v("\n    "+e._s(e.content.display_name)+"\n  ")]),e._v(" "),n("dl",{staticClass:"tui-linkedReviewViewEvidence__customFields"},e._l(e.fields,(function(t){var i=t.label,a=t.type,r=t.content;return n("div",{key:i,staticClass:"tui-linkedReviewViewEvidence__customFields-field"},[n("dt",[e._v(e._s(i))]),e._v(" "),"file"!==a?n("dd",{domProps:{innerHTML:e._s(r.html)}}):n("dd",[r.file_name?n("FileCard",{attrs:{"file-size":r.file_size,filename:r.file_name,"download-url":r.url}}):n("p",[e._v("\n          "+e._s(r.html)+"\n        ")])],1)])})),0),e._v(" "),n("div",{staticClass:"tui-linkedReviewViewEvidence__type"},[e._v("\n    "+e._s(e.content.type.name)+"\n  ")])])}),[],!1,null,null,null);r.options.__hasBlocks={script:!0,template:!0};const d=r.exports},uhT0:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});const i=tui.require("totara_evidence/components/adder/EvidenceAdder");var a=n.n(i);const r=tui.require("performelement_linked_review/components/SelectContent");var d=n.n(r);const l={components:{EvidenceAdder:a(),SelectContent:d()},props:{canShowAdder:{type:Boolean,required:!0},contentType:String,coreRelationship:Array,isDraft:Boolean,participantInstanceId:{type:[String,Number],required:!0},previewComponent:[Function,Object],required:Boolean,sectionElementId:String,subjectUser:Object,userId:Number},computed:{cantAddText(){return this.$str("awaiting_selection_text","totara_evidence",this.coreRelationship[0].name)},adder:()=>a()},methods:{getItemData({created_at:e,fields:t,id:n,name:i,type:a}){return{display_name:i,id:n,fields:t,type:a,content_type:this.contentType,created_at:e}}}},s=function(e){e.options.__langStrings={totara_evidence:["add_evidence","awaiting_selection_text","remove_evidence"]}};var c=(0,n("wWJ2").Z)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("SelectContent",{attrs:{adder:e.adder,"add-btn-text":e.$str("add_evidence","totara_evidence"),"can-show-adder":e.canShowAdder,"cant-add-text":e.cantAddText,"is-draft":e.isDraft,"participant-instance-id":e.participantInstanceId,"remove-text":e.$str("remove_evidence","totara_evidence"),required:e.required,"section-element-id":e.sectionElementId,"user-id":e.userId},on:{"unsaved-plugin-change":function(t){return e.$emit("unsaved-plugin-change",t)},update:function(t){return e.$emit("update",t)}},scopedSlots:e._u([{key:"content-preview",fn:function(t){var i=t.content;return[n(e.previewComponent,{tag:"component",attrs:{content:e.getItemData(i)}})]}}])})}),[],!1,null,null,null);s(c),c.options.__hasBlocks={script:!0,template:!0};const o=c.exports},wWJ2:(e,t,n)=>{"use strict";function i(e,t,n,i,a,r,d,l){var s,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=n,c._compiled=!0),i&&(c.functional=!0),r&&(c._scopeId="data-v-"+r),d?(s=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),a&&a.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(d)},c._ssrRegister=s):a&&(s=l?function(){a.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:a),s)if(c.functional){c._injectStyles=s;var o=c.render;c.render=function(e,t){return s.call(t),o(e,t)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,s):[s]}return{exports:e,options:c}}n.d(t,{Z:()=>i})}},t={};function n(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){"use strict";"undefined"!=typeof tui&&tui._bundle.isLoaded("totara_evidence")?console.warn('[tui bundle] The bundle "totara_evidence" is already loaded, skipping initialisation.'):(tui._bundle.register("totara_evidence"),tui._bundle.addModulesFromContext("totara_evidence/components",n("JVcY")))}()})();