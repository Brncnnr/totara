(()=>{var e={vOmy:(e,t,i)=>{var r={"./Oauth2ProviderContent":"0JxX","./Oauth2ProviderContent.vue":"0JxX","./action/Oauth2ProviderAction":"vQvn","./action/Oauth2ProviderAction.vue":"vQvn","./modal/Oauth2ProviderModal":"SSir","./modal/Oauth2ProviderModal.vue":"SSir"};function a(e){var t=o(e);return i(t)}function o(e){if(!i.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=o,e.exports=a,a.id="vOmy"},fls2:(e,t,i)=>{var r={"./Oauth2Provider":"FTHu","./Oauth2Provider.vue":"FTHu"};function a(e){var t=o(e);return i(t)}function o(e){if(!i.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=o,e.exports=a,a.id="fls2"},"0JxX":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>c});var r=i("ApK1"),a=i.n(r);const o=tui.require("tui/components/form/InputSizedText");var n=i.n(o);const s=tui.require("tui/config"),u={components:{Form:a(),InputSizedText:n()},methods:{getOauthUrl:()=>s.config.wwwroot+"/totara/oauth2/token.php",getXapiUrl:()=>s.config.wwwroot+"/totara/xapi/receiver.php"}},d=function(e){e.options.__langStrings={totara_oauth2:["oauth_url_desc","oauth_url_title","xapi_url_desc"]}};var l=(0,i("wWJ2").Z)(u,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Form",{staticClass:"tui-oauth2ProviderContent"},[i("InputSizedText",[e._v("\n    "+e._s(e.$str("oauth_url_title","totara_oauth2"))+"\n  ")]),e._v(" "),i("InputSizedText",{domProps:{innerHTML:e._s(e.$str("oauth_url_desc","totara_oauth2"))}}),e._v(" "),i("InputSizedText",{staticClass:"tui-oauth2ProviderContent__url"},[e._v("\n    "+e._s(e.getOauthUrl())+"\n  ")]),e._v(" "),i("InputSizedText",{domProps:{innerHTML:e._s(e.$str("xapi_url_desc","totara_oauth2"))}}),e._v(" "),i("InputSizedText",{staticClass:"tui-oauth2ProviderContent__url"},[e._v("\n    "+e._s(e.getXapiUrl())+"\n  ")])],1)}),[],!1,null,null,null);d(l),l.options.__hasBlocks={script:!0,template:!0};const c=l.exports},vQvn:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>p});const r=tui.require("tui/components/dropdown/Dropdown");var a=i.n(r);const o=tui.require("tui/components/buttons/MoreIcon");var n=i.n(o);const s=tui.require("tui/components/dropdown/DropdownItem");var u=i.n(s);const d={components:{Dropdown:a(),MoreIcon:n(),DropdownItem:u()},props:{providerName:{type:String,required:!0}}},l=function(e){e.options.__langStrings={core:["delete"],totara_oauth2:["actions_for","delete_provider_name"]}};var c=(0,i("wWJ2").Z)(d,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"tui-oauth2ProviderAction"},[i("Dropdown",{scopedSlots:e._u([{key:"trigger",fn:function(t){var r=t.toggle,a=t.isOpen;return[i("MoreIcon",{attrs:{"aria-expanded":a?"true":"false","aria-label":e.$str("actions_for","totara_oauth2",e.providerName),size:300},on:{click:r}})]}}])},[e._v(" "),i("DropdownItem",{attrs:{title:e.$str("delete_provider_name","totara_oauth2",e.providerName),"aria-label":e.$str("delete_provider_name","totara_oauth2",e.providerName)},on:{click:function(t){return e.$emit("delete-provider")}}},[e._v("\n      "+e._s(e.$str("delete","core"))+"\n    ")])],1)],1)}),[],!1,null,null,null);l(c),c.options.__hasBlocks={script:!0,template:!0};const p=c.exports},SSir:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>y});const r=tui.require("tui/components/buttons/ButtonGroup");var a=i.n(r),o=i("IpiT"),n=i.n(o),s=i("2XTD"),u=i.n(s);const d=tui.require("tui/components/buttons/Cancel");var l=i.n(d);const c=tui.require("tui/components/form/Checkbox");var p=i.n(c);const m=tui.require("tui/components/uniform"),v=tui.require("tui/components/modal/Modal");var _=i.n(v);const h=tui.require("tui/components/modal/ModalContent");var f=i.n(h);const k={components:{ButtonGroup:a(),Button:n(),Checkbox:p(),Cancel:l(),FormRow:u(),FormText:m.FormText,Modal:_(),ModalContent:f(),Uniform:m.Uniform,FormTextarea:m.FormTextarea},props:{title:{type:String,required:!0},showCloseButton:{type:Boolean,default:!0},isSaving:{type:Boolean,default:!1}},data:()=>({initialValues:{name:"",xapi_write:"XAPI_WRITE",description:""},formValues:null}),methods:{setRows(e,t,i){let r="";this.formValues&&e in this.formValues?r=this.formValues[e]:this.initialValues&&e in this.initialValues&&(r=this.initialValues[e]);let a=(r.match(/\n/g)||[]).length+1;return a<t?t:a>i?i:a}}},g=function(e){e.options.__langStrings={totara_oauth2:["add_provider","description","required_fields","scopes","xapi_write"],core:["name"]}};var b=(0,i("wWJ2").Z)(k,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{staticClass:"tui-oauth2ProviderForm",attrs:{"aria-labelledby":e.$id("title")}},[i("ModalContent",{attrs:{title:e.title,"title-id":e.$id("title"),"close-button":e.showCloseButton},scopedSlots:e._u([{key:"buttons",fn:function(){return[i("ButtonGroup",{staticClass:"tui-oauth2ProviderForm__buttonGroup"},[i("Button",{attrs:{styleclass:{primary:!0},text:e.$str("add_provider","totara_oauth2"),"aria-label":e.$str("add_provider","totara_oauth2"),type:"submit",disabled:e.isSaving},on:{click:function(t){return e.$refs.form.submit()}}}),e._v(" "),i("Cancel",{attrs:{disabled:e.isSaving},on:{click:function(t){return e.$emit("request-close")}}})],1)]},proxy:!0}])},[i("Uniform",{ref:"form",attrs:{"initial-values":e.initialValues,"input-width":"full"},on:{change:function(t){e.formValues=t},submit:function(t){return e.$emit("submit",t)}}},[i("FormRow",{staticClass:"tui-oauth2ProviderForm__required",attrs:{"aria-hidden":"true"}},[i("span",{staticClass:"tui-oauth2ProviderForm__requiredStar"},[e._v("\n          *\n        ")]),e._v("\n        "+e._s(e.$str("required_fields","totara_oauth2"))+"\n      ")]),e._v(" "),i("FormRow",{attrs:{label:e.$str("name","core"),required:"",vertical:!0},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.id;return[i("FormText",{attrs:{id:t,name:"name",validations:function(e){return[e.required()]},maxlength:75}})]}}])}),e._v(" "),i("FormRow",{attrs:{label:e.$str("description","totara_oauth2"),vertical:!0},scopedSlots:e._u([{key:"default",fn:function(t){return t.id,[i("FormTextarea",{attrs:{name:"description",maxlength:1024,"aria-describedby":e.$id("desc-desc"),rows:e.setRows("description",8,25)}})]}}])}),e._v(" "),i("FormRow",{attrs:{label:e.$str("scopes","totara_oauth2"),vertical:!0}},[i("Checkbox",{staticClass:"tui-oauth2ProviderForm__checkBox",attrs:{name:"xapi_write",disabled:"",checked:""}},[e._v("\n          "+e._s(e.$str("xapi_write","totara_oauth2"))+"\n        ")])],1),e._v(" "),i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{type:"submit",disabled:e.isSaving}})],1)],1)],1)}),[],!1,null,null,null);g(b),b.options.__hasBlocks={script:!0,template:!0};const y=b.exports},FTHu:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>V});var r=i("IpiT"),a=i.n(r);const o=tui.require("tui/components/collapsible/Collapsible");var n=i.n(o);const s=tui.require("tui/components/modal/ConfirmationModal");var u=i.n(s),d=i("ApK1"),l=i.n(d),c=i("2XTD"),p=i.n(c);const m=tui.require("tui/components/layouts/LayoutOneColumn");var v=i.n(m);const _=tui.require("tui/components/modal/ModalPresenter");var h=i.n(_);const f=tui.require("totara_oauth2/components/Oauth2ProviderContent");var k=i.n(f);const g=tui.require("totara_oauth2/components/modal/Oauth2ProviderModal");var b=i.n(g);const y=tui.require("totara_oauth2/components/action/Oauth2ProviderAction");var w=i.n(y);const S=tui.require("tui/components/form/InputGroup");var x=i.n(S);const P=tui.require("tui/components/form/InputGroupInput");var N=i.n(P);const C=tui.require("tui/components/form/InputGroupButton");var F=i.n(C);const O=tui.require("tui/notifications"),$={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"totara_oauth2_client_providers"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"totara_oauth2_client_providers_input"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"providers"},name:{kind:"Name",value:"totara_oauth2_client_providers"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"items"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"client_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"client_secret"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"PLAIN"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"HTML"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"scope"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"detail_scope"},arguments:[],directives:[]}]}}]}}]}}]},T={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"totara_oauth2_create_provider"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"totara_oauth2_provider_input"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"provider"},name:{kind:"Name",value:"totara_oauth2_create_provider"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"client_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"client_secret"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"PLAIN"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"HTML"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"scope"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"detail_scope"},arguments:[],directives:[]}]}}]}}]},q={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"totara_oauth2_delete_provider"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"core_id"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"result"},name:{kind:"Name",value:"totara_oauth2_delete_provider"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[]}]}}]},M={components:{Button:a(),Collapsible:n(),DeleteConfirmationModal:u(),FormRow:p(),Form:l(),Layout:v(),ModalPresenter:h(),Oauth2ProviderModal:b(),Oauth2ProviderContent:k(),Oauth2ProviderAction:w(),InputGroup:x(),InputGroupInput:N(),InputGroupButton:F()},data:()=>({providers:[],modalOpen:!1,deleteModalOpen:!1,deleting:!1,isSaving:!1,expanded:{},targetProvider:{},showSecret:{}}),computed:{hasNoRecordError(){return 0===this.providers.length}},apollo:{providers:{query:$,variables:()=>({input:{}}),update:({providers:{items:e}})=>e}},created(){this.providers.forEach((e=>this.expanded[e.id]=!1))},methods:{async createProvider(e){this.isSaving=!0;try{const{data:{provider:t}}=await this.$apollo.mutate({mutation:T,variables:{input:{name:e.name,description:e.description,scope_type:e.xapi_write}},update:(e,{data:{provider:t}})=>{const i={input:{}},{providers:{items:r}}=e.readQuery({query:$,variables:i}),a=[...r];t&&a.push(t),e.writeQuery({query:$,variables:i,data:{providers:{items:a.sort(((e,t)=>e.name.localeCompare(t.name)))}}})}});t&&(this.providers.forEach((e=>this.expanded[e.id]=!1)),this.modalOpen=!1,this.expanded[t.id]=!0,await(0,O.notify)({message:this.$str("provider_added","totara_oauth2"),type:"success"}))}finally{this.isSaving=!1}},handleCollapsibleChange(e,t){this.expanded=Object.assign({},this.expanded,{[t]:e})},openDeleteModal(e){this.targetProvider=e,this.deleteModalOpen=!0},async deleteProvider(){if(this.deleteModalOpen&&this.targetProvider)try{this.deleting=!0;const{data:{result:e}}=await this.$apollo.mutate({mutation:q,variables:{id:this.targetProvider.id},update:e=>{const t={input:{}},{providers:{items:i}}=e.readQuery({query:$,variables:t}),r=[...i];e.writeQuery({query:$,variables:t,data:{providers:{items:r.filter((e=>e.id!==this.targetProvider.id))}}})}});e&&(0,O.notify)({type:"success",message:this.$str("delete_success","totara_oauth2")})}finally{this.deleteModalOpen=!1,this.deleting=!1}},toggleSecretVisibility(e){this.$set(this.showSecret,e,!this.showSecret[e])},showHideText(e){return this.showSecret[e]?this.$str("hide","totara_oauth2"):this.$str("show","totara_oauth2")},showHideAriaLabel(e){return this.showSecret[e.id]?this.$str("hide_client_secret_aria","totara_oauth2",e.name):this.$str("show_client_secret_aria","totara_oauth2",e.name)}}},I=function(e){e.options.__langStrings={totara_oauth2:["add_provider","add_oauth2_provider","client_provider_description","client_id","client_secret","continue","delete_confirm_body","delete_confirm_title","delete_modal_title","delete_success","scopes","no_record_found","oauth2providerdetails","provider_added","show","show_client_secret_aria","hide","hide_client_secret_aria"]}};var D=(0,i("wWJ2").Z)(M,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Layout",{staticClass:"tui-oauth2ProviderPage",attrs:{title:e.$str("oauth2providerdetails","totara_oauth2"),loading:e.$apollo.loading},scopedSlots:e._u([{key:"header-buttons",fn:function(){return[i("Button",{attrs:{text:e.$str("add_provider","totara_oauth2")},on:{click:function(t){t.preventDefault(),e.modalOpen=!0}}})]},proxy:!0},{key:"modals",fn:function(){return[i("ModalPresenter",{attrs:{open:e.modalOpen},on:{"request-close":function(t){e.modalOpen=!1}}},[i("Oauth2ProviderModal",{attrs:{title:e.$str("add_oauth2_provider","totara_oauth2"),"is-saving":e.isSaving},on:{submit:e.createProvider}})],1),e._v(" "),i("DeleteConfirmationModal",{attrs:{open:e.deleteModalOpen,title:e.$str("delete_modal_title","totara_oauth2"),"confirm-button-text":e.$str("continue","totara_oauth2"),loading:e.deleting,"close-button":!0},on:{confirm:e.deleteProvider,cancel:function(t){e.deleteModalOpen=!1}}},[[i("p",[e._v(e._s(e.$str("delete_confirm_title","totara_oauth2")))]),e._v(" "),i("p",{staticClass:"tui-oauth2ProviderPage__deleteBody",domProps:{innerHTML:e._s(e.$str("delete_confirm_body","totara_oauth2",e.targetProvider.name))}})]],2)]},proxy:!0},e.$apollo.loading?null:{key:"content",fn:function(){return[e.hasNoRecordError?[i("p",{staticClass:"tui-oauth2ProviderPage__errorTitle"},[e._v("\n        "+e._s(e.$str("no_record_found","totara_oauth2"))+"\n      ")])]:[e._l(e.providers,(function(t){return i("Collapsible",{key:t.id,staticClass:"tui-oauth2ProviderPage__provider",attrs:{label:t.name,value:e.expanded[t.id]},on:{input:function(i){return e.handleCollapsibleChange(i,t.id)}},scopedSlots:e._u([{key:"collapsible-side-content",fn:function(){return[i("Oauth2ProviderAction",{attrs:{"provider-name":t.name},on:{"delete-provider":function(i){return e.openDeleteModal(t)}}})]},proxy:!0}],null,!0)},[e._v(" "),i("Form",{staticClass:"tui-oauth2ProviderPage__form"},[t.description?i("FormRow",{staticClass:"tui-oauth2ProviderPage__formDesc",attrs:{vertical:!0},domProps:{innerHTML:e._s(t.description)}}):e._e(),e._v(" "),i("FormRow",{class:{"tui-oauth2ProviderPage__clientId":!t.description},attrs:{label:e.$str("client_id","totara_oauth2")}},[i("span",{staticClass:"tui-oauth2ProviderPage__monospaceFont"},[e._v("\n              "+e._s(t.client_id)+"\n            ")])]),e._v(" "),i("FormRow",{attrs:{label:e.$str("client_secret","totara_oauth2")},scopedSlots:e._u([{key:"default",fn:function(r){var a=r.id,o=r.labelId;return[i("InputGroup",{attrs:{"aria-labelledby":o}},[[i("InputGroupInput",{attrs:{id:a,monospace:!0,readonly:"",type:e.showSecret[t.id]?"text":"password",value:t.client_secret}}),e._v(" "),i("InputGroupButton",{staticClass:"tui-oauth2ProviderPage__inputGroupBtn",attrs:{"aria-controls":a,"aria-label":e.showHideAriaLabel(t),text:e.showHideText(t.id)},on:{click:function(i){return e.toggleSecretVisibility(t.id)}}})]],2)]}}],null,!0)}),e._v(" "),i("FormRow",{attrs:{label:e.$str("scopes","totara_oauth2")}},[e._v("\n            "+e._s(t.detail_scope)+"\n          ")])],1)],1)})),e._v(" "),i("Oauth2ProviderContent")]]},proxy:!0}],null,!0)})}),[],!1,null,null,null);I(D),D.options.__hasBlocks={script:!0,template:!0};const V=D.exports},wWJ2:(e,t,i)=>{"use strict";function r(e,t,i,r,a,o,n,s){var u,d="function"==typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=i,d._compiled=!0),r&&(d.functional=!0),o&&(d._scopeId="data-v-"+o),n?(u=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),a&&a.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(n)},d._ssrRegister=u):a&&(u=s?function(){a.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:a),u)if(d.functional){d._injectStyles=u;var l=d.render;d.render=function(e,t){return u.call(t),l(e,t)}}else{var c=d.beforeCreate;d.beforeCreate=c?[].concat(c,u):[u]}return{exports:e,options:d}}i.d(t,{Z:()=>r})},IpiT:e=>{"use strict";e.exports=tui.require("tui/components/buttons/Button")},"2XTD":e=>{"use strict";e.exports=tui.require("tui/components/form/FormRow")},ApK1:e=>{"use strict";e.exports=tui.require("tui/components/form/Form")}},t={};function i(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){"use strict";"undefined"!=typeof tui&&tui._bundle.isLoaded("totara_oauth2")?console.warn('[tui bundle] The bundle "totara_oauth2" is already loaded, skipping initialisation.'):(tui._bundle.register("totara_oauth2"),tui._bundle.addModulesFromContext("totara_oauth2/components",i("vOmy")),tui._bundle.addModulesFromContext("totara_oauth2/pages",i("fls2")))}()})();