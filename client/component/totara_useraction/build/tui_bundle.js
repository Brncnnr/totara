(()=>{var e={hqj3:(e,t,n)=>{var i={"./scheduled_rules/AppliesToSelector":"O4SG","./scheduled_rules/AppliesToSelector.vue":"O4SG","./scheduled_rules/DurationInput":"xp3S","./scheduled_rules/DurationInput.vue":"xp3S","./scheduled_rules/RuleExtraDetail":"fT0/","./scheduled_rules/RuleExtraDetail.vue":"fT0/"};function a(e){var t=r(e);return n(t)}function r(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=r,e.exports=a,a.id="hqj3"},r1xD:(e,t,n)=>{var i={"./EditScheduledAction":"YORh","./EditScheduledAction.vue":"YORh","./ScheduledActions":"7SgP","./ScheduledActions.vue":"7SgP"};function a(e){var t=r(e);return n(t)}function r(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=r,e.exports=a,a.id="r1xD"},O4SG:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>S});const i=tui.require("tui/components/adder/AudienceAdder");var a=n.n(i),r=n("IpiT"),s=n.n(r);const o=tui.require("tui/components/buttons/ButtonIcon");var u=n.n(o),l=n("3NWB"),d=n.n(l),c=n("6e83"),m=n.n(c);const _=tui.require("tui/components/icons/Add");var p=n.n(_);const v=tui.require("tui/components/icons/Remove");var h=n.n(v);const k={components:{AudienceAdder:a(),Button:s(),ButtonIcon:u(),Dropdown:d(),DropdownItem:m(),AddIcon:p(),RemoveIcon:h()},props:{value:Array},data:()=>({showAdder:!1}),computed:{isAudiences(){return Array.isArray(this.value)},currentSelectionLabel(){return this.isAudiences?this.$str("filter_applies_to_audiences_x","totara_useraction",this.value.length):this.$str("filter_applies_to_all_users","totara_useraction")},addedIds(){return this.isAudiences?this.value.map((e=>e.id)):[]}},methods:{selectAudiences(){this.isAudiences||this.$emit("input",[]),this.showAdder=!0},adderUpdate(e){this.$emit("input",e.data.map((({id:e,name:t})=>({id:e,name:t})))),this.showAdder=!1},adderCancelled(){this.showAdder=!1},removeAudience(e){this.$emit("input",this.value.filter((t=>t.id!=e.id)))}}},f=function(e){e.options.__langStrings={totara_useraction:["add_audience","filter_applies_to_all_users","filter_applies_to_audiences_x","remove_x"]}};var g=(0,n("wWJ2").Z)(k,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-totara_useraction-appliesToSelector",attrs:{role:"group"}},[n("Dropdown",{scopedSlots:e._u([{key:"trigger",fn:function(t){var i=t.toggle,a=t.isOpen;return[n("Button",{attrs:{"aria-expanded":a.toString(),caret:!0,text:e.currentSelectionLabel},on:{click:i}})]}}])},[e._v(" "),n("DropdownItem",{on:{click:function(t){return e.$emit("input",null)}}},[e._v("All users")]),e._v(" "),n("DropdownItem",{on:{click:e.selectAudiences}},[e._v("\n      Audiences\n    ")])],1),e._v(" "),e.isAudiences?n("div",{staticClass:"tui-totara_useraction-appliesToSelector__list"},[e._l(e.value,(function(t){return n("div",{key:t.id,staticClass:"tui-totara_useraction-appliesToSelector__audience"},[n("a",{attrs:{href:e.$url("/cohort/view.php",{id:t.id})}},[e._v("\n        "+e._s(t.name)+"\n      ")]),e._v(" "),n("ButtonIcon",{attrs:{styleclass:{small:!0,transparent:!0},"aria-label":e.$str("remove_x","totara_useraction",t.name)},on:{click:function(n){return e.removeAudience(t)}}},[n("RemoveIcon")],1)],1)})),e._v(" "),n("ButtonIcon",{attrs:{text:e.$str("add_audience","totara_useraction"),styleclass:{small:!0}},on:{click:e.selectAudiences}},[n("AddIcon")],1)],2):e._e(),e._v(" "),n("AudienceAdder",{attrs:{open:e.showAdder,"existing-items":e.addedIds},on:{added:e.adderUpdate,cancel:e.adderCancelled}})],1)}),[],!1,null,null,null);f(g),g.options.__hasBlocks={script:!0,template:!0};const S=g.exports},xp3S:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});const i=tui.require("tui/components/form/InputNumber");var a=n.n(i);const r=tui.require("tui/components/form/InputSet");var s=n.n(r);const o=tui.require("tui/components/form/Select");var u=n.n(o);const l={components:{InputNumber:a(),InputSet:s(),Select:u()},props:{value:Object},data(){return{durationValue:this.value&&this.value.value,durationUnit:this.value&&this.value.unit,durationUnitOptions:[{id:"DAY",label:this.$str("unit_days","totara_useraction")},{id:"MONTH",label:this.$str("unit_months","totara_useraction")},{id:"YEAR",label:this.$str("unit_years","totara_useraction")}]}},computed:{selectedValue(){const e=this.durationValue,t=this.durationUnit;return e&&t?{value:e,unit:t}:null}},watch:{value(){this.isValueEqual(this.value,this.selectedValue)||(this.value?(this.durationUnit=this.value.unit,this.durationValue=this.value.value):this.durationValue="")},selectedValue(){this.isValueEqual(this.value,this.selectedValue)||this.$emit("input",this.selectedValue)}},methods:{isValueEqual:(e,t)=>e==t&&!(null==e||null==t)&&e.value==t.value&&e.unit==t.unit}},d=function(e){e.options.__langStrings={totara_useraction:["duration_unit","duration_value","unit_days","unit_months","unit_years"]}};var c=(0,n("wWJ2").Z)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("InputSet",{attrs:{"char-length":"full"}},[n("InputNumber",{attrs:{"aria-label":e.$str("duration_value","totara_useraction"),"char-length":"5"},model:{value:e.durationValue,callback:function(t){e.durationValue=t},expression:"durationValue"}}),e._v(" "),n("Select",{attrs:{"aria-label":e.$str("duration_unit","totara_useraction"),options:e.durationUnitOptions,"char-length":"10"},model:{value:e.durationUnit,callback:function(t){e.durationUnit=t},expression:"durationUnit"}})],1)}),[],!1,null,null,null);d(c),c.options.__hasBlocks={script:!0,template:!0};const m=c.exports},"fT0/":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});const i=tui.require("tui/components/form/Form");var a=n.n(i);const r=tui.require("tui/components/form/FormRow");var s=n.n(r),o=n("qhSB"),u=n.n(o);const l={components:{Form:a(),FormRow:s(),InputSizedText:u()},props:{rule:Object},data(){return{userStatuses:{SUSPENDED:this.$str("suspended","core")},durationSources:{DATE_SUSPENDED:this.$str("date_suspended","totara_useraction")}}},computed:{audiences(){return this.rule.filters.applies_to.audiences}},methods:{formatDuration(e){const{value:t,unit:n}=e.filters.duration,i=1===t;switch(n){case"DAY":return i?this.$str("numday","core",t):this.$str("numdays","core",t);case"MONTH":return i?this.$str("nummonth","core",t):this.$str("nummonths","core",t);case"YEAR":return i?this.$str("numyear","core",t):this.$str("numyears","core",t)}}}},d=function(e){e.options.__langStrings={core:["numday","numdays","nummonth","nummonths","suspended","numyear","numyears"],totara_useraction:["applies_to","criteria","data_source","date_suspended","duration","filter_applies_to_all_users","no_audiences_selected","user_status"]}};var c=(0,n("wWJ2").Z)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-totara_useraction-ruleExtraDetail"},[n("div",{staticClass:"tui-totara_useraction-ruleExtraDetail__header"},[e._v("\n    "+e._s(e.$str("criteria","totara_useraction"))+"\n  ")]),e._v(" "),n("div",{staticClass:"tui-totara_useraction-ruleExtraDetail__description",domProps:{textContent:e._s(e.rule.description)}}),e._v(" "),n("Form",{attrs:{"input-width":"full"}},[n("div",[n("FormRow",{attrs:{label:e.$str("applies_to","totara_useraction")}},[n("InputSizedText",[e.audiences?[e._l(e.audiences,(function(t,i){return[n("a",{key:t.id,attrs:{href:e.$url("/cohort/view.php",{id:t.id})}},[e._v(e._s(t.name))]),e._v(e._s(e.audiences.length-1===i?"":", ")+"\n            ")]})),e._v(" "),0===e.audiences.length?[e._v("\n              "+e._s(e.$str("no_audiences_selected","totara_useraction"))+"\n            ")]:e._e()]:[e._v("\n            "+e._s(e.$str("filter_applies_to_all_users","totara_useraction"))+"\n          ")]],2)],1),e._v(" "),n("FormRow",{attrs:{label:e.$str("user_status","totara_useraction")}},[n("InputSizedText",[e._v("\n          "+e._s(e.userStatuses[e.rule.filters.user_status]||e.rule.filters.user_status)+"\n        ")])],1),e._v(" "),n("FormRow",{attrs:{label:e.$str("data_source","totara_useraction")}},[n("InputSizedText",[e._v("\n          "+e._s(e.durationSources[e.rule.filters.duration.source]||e.rule.filters.duration.source)+"\n        ")])],1),e._v(" "),n("FormRow",{attrs:{label:e.$str("duration","totara_useraction")}},[n("InputSizedText",[e._v("\n          "+e._s(e.formatDuration(e.rule))+"\n        ")])],1)],1)])],1)}),[],!1,null,null,null);d(c),c.options.__hasBlocks={script:!0,template:!0};const m=c.exports},YORh:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>A});const i=tui.require("tui/i18n");var a=n("ijCJ"),r=n.n(a);const s=tui.require("tui/components/uniform");var o=n("qhSB"),u=n.n(o);const l=tui.require("tui/components/buttons/ButtonGroup");var d=n.n(l),c=n("IpiT"),m=n.n(c);const _=tui.require("tui/components/modal/Modal");var p=n.n(_);const v=tui.require("tui/components/modal/ModalContent");var h=n.n(v);const k=tui.require("tui/components/modal/ModalPresenter");var f=n.n(k);const g=tui.require("tui/components/notifications/NotificationBanner");var S=n.n(g);const b=tui.require("totara_useraction/components/scheduled_rules/AppliesToSelector");var N=n.n(b);const y=tui.require("totara_useraction/components/scheduled_rules/DurationInput");var w=n.n(y);const $={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"totara_useraction_create_scheduled_rule"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"totara_useraction_scheduled_rule_input"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"rule"},name:{kind:"Name",value:"totara_useraction_create_scheduled_rule"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]},F={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"totara_useraction_update_scheduled_rule"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"totara_useraction_update_scheduled_rule_input"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"rule"},name:{kind:"Name",value:"totara_useraction_update_scheduled_rule"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]},x={components:{LayoutOneColumn:r(),FormCheckbox:s.FormCheckbox,FormField:s.FormField,FormRow:s.FormRow,FormRowStack:s.FormRowStack,FormSelect:s.FormSelect,FormText:s.FormText,FormTextarea:s.FormTextarea,Uniform:s.Uniform,InputSizedText:u(),ButtonGroup:d(),Button:m(),Modal:p(),ModalContent:h(),ModalPresenter:f(),NotificationBanner:S(),AppliesToSelector:N(),DurationInput:w()},props:{id:Number,actions:{type:Object,required:!0}},data(){return{submitting:!1,actionData:null,cancelModalVisible:!1,bannerError:null,userStatusOptions:[{id:"SUSPENDED",label:this.$str("suspended","core")}],durationSourceOptions:[{id:"DATE_SUSPENDED",label:this.$str("date_suspended","totara_useraction")}]}},computed:{loading(){return!this.isNew&&!this.actionData},isNew(){return null==this.id},saveButtonText(){return this.isNew?this.$str("add","totara_core"):this.$str("save","totara_core")},initialValues(){const e=this.actionData;if(!e)return{action:1===this.actionOptions.length?this.actionOptions[0].id:null,userStatus:this.userStatusOptions[0].id,durationSource:this.durationSourceOptions[0].id,duration:{value:"1",unit:"YEAR"},audiences:null};const{duration:t}=e.filters;return{name:e.name,idNumber:e.id_number,description:e.description,enabled:e.status,action:e.action&&e.action.identifier,userStatus:e.filters.user_status,durationSource:t.source,duration:{unit:t.unit,value:parseInt(t.value)},audiences:e.filters.applies_to.audiences||null}},actionOptions(){return Object.entries(this.actions).map((([e,t])=>({id:e,label:t})))}},apollo:{actionData:{query:{kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"totara_useraction_scheduled_rule_for_editing"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"core_id"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"rule"},name:{kind:"Name",value:"totara_useraction_scheduled_rule"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"RAW"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"RAW"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"action"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"identifier"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"filters"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user_status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"duration"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"source"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"unit"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"value"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"applies_to"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"totara_useraction_filters_applies_to_audiences"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"audiences"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"PLAIN"}}],directives:[]}]}}]}}]}}]}}]}}]}}]},update:e=>e.rule,skip(){return this.isNew},variables(){return{id:this.id}}}},methods:{validateDuration(e){return String(e.value).includes(".")?(0,i.langString)("validation_invalid_integer","totara_core"):parseInt(e.value)<1?this.$str("error_must_be_at_least_1","totara_useraction"):void 0},async handleSubmit(e){this.bannerError=null;const t={name:e.name,description:e.description,status:e.enabled,action:e.action,filter_user_status:e.userStatus,filter_duration:{source:e.durationSource,unit:e.duration.unit,value:parseInt(e.duration.value)},filter_applies_to:{audiences:e.audiences?e.audiences.map((e=>e.id)):null}};this.isNew||(t.id=this.id),this.submitting=!0;try{await this.$apollo.mutate({mutation:this.isNew?$:F,variables:{input:t}}),window.location=this.$url("/totara/useraction/scheduled_actions.php?edit_success=1")}catch(e){const t=e.graphQLErrors&&e.graphQLErrors[0];if(!t||!t.extensions||"totara_useraction/validation"!==t.extensions.category)throw e;this.bannerError=t.message,this.$nextTick((()=>{this.$refs.errorBanner&&this.$refs.errorBanner.$el.scrollIntoView({behavior:"smooth",block:"nearest"})}))}finally{this.submitting=!1}},handleCancel(){this.cancelModalVisible=!0},handleCancelCancel(){this.cancelModalVisible=!1},handleCancelConfirm(){window.location=this.$url("/totara/useraction/scheduled_actions.php")}}},C=function(e){e.options.__langStrings={core:["cancel","description","general","no","status","suspended","yes"],totara_core:["add","enabled","required_fields","save"],totara_useraction:["action_name","action_type_help","action_type","add_scheduled_action","applies_to","criteria","data_source","data_source_help","date_suspended","discard_changes","duration","duration_help","edit_scheduled_action","error_must_be_at_least_1","exit_without_saving","id","status_help","unsaved_changes_message","user_status","user_status_help"]}};var D=(0,n("wWJ2").Z)(x,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("LayoutOneColumn",{staticClass:"tui-totara_useraction-editScheduledAction",attrs:{title:e.isNew?e.$str("add_scheduled_action","totara_useraction"):e.$str("edit_scheduled_action","totara_useraction"),loading:e.loading},scopedSlots:e._u([e.bannerError?{key:"feedback-banner",fn:function(){return[n("NotificationBanner",{ref:"errorBanner",attrs:{type:"error",dismissable:!0,message:e.bannerError},on:{dismiss:function(t){e.bannerError=null}}})]},proxy:!0}:null,e.loading?null:{key:"content",fn:function(){return[n("Uniform",{attrs:{"initial-values":e.initialValues},on:{submit:e.handleSubmit}},[n("FormRowStack",[n("div",{attrs:{"aria-hidden":"true"}},[n("span",{staticClass:"tui-totara_useraction-editScheduledAction__requiredStar"},[e._v("\n            *\n          ")]),e._v("\n          "+e._s(e.$str("required_fields","totara_core"))+"\n        ")]),e._v(" "),n("h3",{staticClass:"tui-totara_useraction-editScheduledAction__sectionHeading"},[e._v("\n          "+e._s(e.$str("general","core"))+"\n        ")]),e._v(" "),n("FormRow",{attrs:{label:e.$str("action_name","totara_useraction"),required:""}},[n("FormText",{attrs:{name:"name",validations:function(e){return[e.required(),e.maxLength(255)]}}})],1),e._v(" "),n("FormRow",{attrs:{label:e.$str("description","core")}},[n("FormTextarea",{attrs:{name:"description",rows:5}})],1),e._v(" "),n("FormRow",{attrs:{label:e.$str("action_type","totara_useraction"),required:"",helpmsg:e.$str("action_type_help","totara_useraction")}},[n("FormSelect",{attrs:{name:"action",options:e.actionOptions,validations:function(e){return[e.required()]}}})],1),e._v(" "),n("FormRow",{attrs:{label:e.$str("status","core"),helpmsg:e.$str("status_help","totara_useraction")}},[n("InputSizedText",[n("FormCheckbox",{attrs:{name:"enabled"}},[e._v("\n              "+e._s(e.$str("enabled","totara_core"))+"\n            ")])],1)],1),e._v(" "),n("h3",{staticClass:"tui-totara_useraction-editScheduledAction__sectionHeading"},[e._v("\n          "+e._s(e.$str("criteria","totara_useraction"))+"\n        ")]),e._v(" "),n("FormRow",{attrs:{label:e.$str("applies_to","totara_useraction"),required:""}},[n("FormField",{attrs:{name:"audiences",required:""},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.labelId,i=e.value,a=e.update;return[n("AppliesToSelector",{attrs:{"aria-labelledby":t,value:i},on:{input:a}})]}}],null,!1,1140341311)})],1),e._v(" "),n("FormRow",{attrs:{label:e.$str("user_status","totara_useraction"),required:"",helpmsg:e.$str("user_status_help","totara_useraction")}},[n("FormSelect",{attrs:{name:"userStatus",options:e.userStatusOptions,validations:function(e){return[e.required()]}}})],1),e._v(" "),n("FormRow",{attrs:{label:e.$str("data_source","totara_useraction"),required:"",helpmsg:e.$str("data_source_help","totara_useraction")}},[n("FormSelect",{attrs:{name:"durationSource",options:e.durationSourceOptions,validations:function(e){return[e.required()]}}})],1),e._v(" "),n("FormRow",{attrs:{label:e.$str("duration","totara_useraction"),required:"",helpmsg:e.$str("duration_help","totara_useraction")}},[n("FormField",{attrs:{name:"duration",required:"",validations:function(t){return[t.required(),e.validateDuration]}},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.labelId,i=e.value,a=e.update;return[n("DurationInput",{attrs:{"aria-labelledby":t,value:i},on:{input:a}})]}}],null,!1,1473703115)})],1),e._v(" "),n("FormRow",{staticClass:"tui-totara_useraction-editScheduledAction__actions"},[n("ButtonGroup",[n("Button",{attrs:{type:"submit",text:e.saveButtonText,styleclass:{primary:"true"},loading:e.submitting}}),e._v(" "),n("Button",{attrs:{text:e.$str("cancel","core"),disabled:e.submitting},on:{click:e.handleCancel}})],1)],1)],1)],1)]},proxy:!0},{key:"modals",fn:function(){return[n("ModalPresenter",{attrs:{open:e.cancelModalVisible},on:{"request-close":e.handleCancelCancel}},[n("Modal",[n("ModalContent",{attrs:{title:e.$str("discard_changes","totara_useraction")},on:{dismiss:e.handleCancelCancel},scopedSlots:e._u([{key:"buttons",fn:function(){return[n("ButtonGroup",[n("Button",{attrs:{styleclass:{primary:"true"},text:e.$str("yes","core")},on:{click:e.handleCancelConfirm}}),e._v(" "),n("Button",{attrs:{text:e.$str("no","core")},on:{click:e.handleCancelCancel}})],1)]},proxy:!0}])},[n("p",[e._v("\n            "+e._s(e.$str("exit_without_saving","totara_useraction"))+"\n          ")]),e._v(" "),n("p",[e._v("\n            "+e._s(e.$str("unsaved_changes_message","totara_useraction"))+"\n          ")])])],1)],1)]},proxy:!0}],null,!0)})}),[],!1,null,null,null);C(D),D.options.__hasBlocks={script:!0,template:!0};const A=D.exports},"7SgP":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>O});const i=tui.require("tui/notifications");var a=n("IpiT"),r=n.n(a);const s=tui.require("tui/components/buttons/MoreIcon");var o=n.n(s);const u=tui.require("tui/components/datatable/Cell");var l=n.n(u);const d=tui.require("tui/components/datatable/ExpandCell");var c=n.n(d);const m=tui.require("tui/components/datatable/HeaderCell");var _=n.n(m);const p=tui.require("tui/components/datatable/Table");var v=n.n(p),h=n("3NWB"),k=n.n(h),f=n("6e83"),g=n.n(f);const S=tui.require("tui/components/dropdown/DropdownButton");var b=n.n(S),N=n("ijCJ"),y=n.n(N);const w=tui.require("tui/components/modal/ConfirmationModal");var $=n.n(w);const F=tui.require("tui/components/paging/Paging");var x=n.n(F);const C=tui.require("totara_useraction/components/scheduled_rules/RuleExtraDetail");var D=n.n(C);const A={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"totara_useraction_delete_scheduled_rule"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"core_id"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"result"},name:{kind:"Name",value:"totara_useraction_delete_scheduled_rule"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[]}]}}]},q={components:{Button:r(),MoreButton:o(),Cell:l(),ExpandCell:c(),HeaderCell:_(),Table:v(),Dropdown:k(),DropdownItem:g(),DropdownButton:b(),LayoutOneColumn:y(),ConfirmationModal:$(),Paging:x(),RuleExtraDetail:D()},data:()=>({page:1,pageSize:20,deleteConfirmationOpen:!1,deleting:!1,editingRow:null}),computed:{initiallyLoading(){return this.$apollo.loading&&!this.scheduledActions},loading(){return this.$apollo.loading},rows(){return this.scheduledActions&&this.scheduledActions.items||[]}},apollo:{scheduledActions:{query:{kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"totara_useraction_scheduled_rules"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"totara_useraction_scheduled_rules_input"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"rules"},name:{kind:"Name",value:"totara_useraction_scheduled_rules"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"items"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tenant_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"PLAIN"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"PLAIN"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"action"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"identifier"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"filters"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user_status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"duration"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"source"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"unit"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"value"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"applies_to"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"totara_useraction_filters_applies_to_audiences"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"audiences"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"PLAIN"}}],directives:[]}]}}]}}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"total"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"next_cursor"},arguments:[],directives:[]}]}}]}}]},fetchPolicy:"network-only",variables(){return{input:{tenant_id:this.tenantId,pagination:{page:this.page,limit:this.pageSize}}}},update:e=>e.rules}},mounted(){const e=window.location.search;this.urlParams=new URLSearchParams(e),this.urlParams.get("edit_success")&&((0,i.notify)({message:this.$str("action_saved","totara_useraction")}),window.history.replaceState(null,null,this.$url("/totara/useraction/scheduled_actions.php")))},methods:{handleCreateClick(){window.location=this.$url("/totara/useraction/add_scheduled_action.php")},handleDeleteClick(e){this.editingRow=e,this.deleteConfirmationOpen=!0},async handleDeleteConfirm(){this.deleting=!0;try{await this.$apollo.mutate({mutation:A,variables:{id:this.editingRow.id},refetchQueries:["totara_useraction_scheduled_rules"],awaitRefetchQueries:!0}),(0,i.notify)({message:this.$str("action_deleted","totara_useraction")})}finally{this.deleting=!1,this.deleteConfirmationOpen=!1}},handleDeleteCancel(){this.deleteConfirmationOpen=!1},handlePageChange(e){this.page=e},handlePageSizeChange(e){this.page=1,this.pageSize=e}}},T=function(e){e.options.__langStrings={core:["delete","status"],totara_useraction:["action_deleted","action_name","action_saved","action_type","actions","add_action","delete_scheduled_action","delete_scheduled_action_confirm_message","disabled","edit_action","enabled","filter_applies_to_all_users","no_actions","scheduled_user_actions","view_history"]}};var E=(0,n("wWJ2").Z)(q,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("LayoutOneColumn",{attrs:{title:e.$str("scheduled_user_actions","totara_useraction"),loading:e.loading},scopedSlots:e._u([{key:"header-buttons",fn:function(){return[n("Button",{attrs:{text:e.$str("add_action","totara_useraction")},on:{click:e.handleCreateClick}})]},proxy:!0},{key:"content",fn:function(){return[n("div",{staticClass:"tui-totara_useraction-scheduledActions__content"},[n("Table",{attrs:{data:e.rows,"expandable-rows":"","expand-multiple-rows":"","stealth-expanded":"","loading-preview":e.loading,"loading-preview-rows":e.pageSize,"loading-overlay-active":"","no-items-text":e.$str("no_actions","totara_useraction")},scopedSlots:e._u([{key:"header-row",fn:function(){return[n("ExpandCell",{attrs:{header:!0}}),e._v(" "),n("HeaderCell",{attrs:{size:"7"}},[e._v("\n            "+e._s(e.$str("action_name","totara_useraction"))+"\n          ")]),e._v(" "),n("HeaderCell",{attrs:{size:"7"}},[e._v("\n            "+e._s(e.$str("action_type","totara_useraction"))+"\n          ")]),e._v(" "),n("HeaderCell",{attrs:{size:"3"}},[e._v(e._s(e.$str("status","core")))]),e._v(" "),n("HeaderCell",{attrs:{size:"2"}})]},proxy:!0},{key:"row",fn:function(t){var i=t.row,a=t.expand,r=t.expandState,s=t.isStacked;return[n("ExpandCell",{attrs:{"aria-label":i.name,"expand-state":r},on:{click:function(e){return a()}}}),e._v(" "),n("Cell",{attrs:{size:"7","column-header":e.$str("action_name","totara_useraction")}},[e._v("\n            "+e._s(i.name)+"\n          ")]),e._v(" "),n("Cell",{attrs:{size:"7","column-header":e.$str("action_type","totara_useraction")}},[e._v("\n            "+e._s(i.action&&i.action.name)+"\n          ")]),e._v(" "),n("Cell",{attrs:{size:"3","column-header":e.$str("status","core")}},[e._v("\n            "+e._s(i.status?e.$str("enabled","totara_useraction"):e.$str("disabled","totara_useraction"))+"\n          ")]),e._v(" "),n("Cell",{attrs:{size:"2","column-header":e.$str("actions","totara_useraction"),valign:"center"}},[n("div",{staticClass:"tui-totara_useraction-scheduledActions__row-actions",class:{"tui-totara_useraction-scheduledActions__row-actions--stacked":s}},[n("Dropdown",{attrs:{position:"bottom-right"},scopedSlots:e._u([{key:"trigger",fn:function(e){var t=e.toggle,i=e.isOpen;return[n("MoreButton",{attrs:{"aria-expanded":i.toString()},on:{click:t}})]}}],null,!0)},[e._v(" "),n("DropdownItem",{attrs:{href:e.$url("/totara/useraction/edit_scheduled_action.php",{id:i.id})}},[e._v("\n                  "+e._s(e.$str("edit_action","totara_useraction"))+"\n                ")]),e._v(" "),n("DropdownButton",{on:{click:function(t){return e.handleDeleteClick(i)}}},[e._v("\n                  "+e._s(e.$str("delete","core"))+"\n                ")]),e._v(" "),n("DropdownItem",{attrs:{href:e.$url("/totara/useraction/history.php",{rule_id:i.id})}},[e._v("\n                  "+e._s(e.$str("view_history","totara_useraction"))+"\n                ")])],1)],1)])]}},{key:"expand-content",fn:function(e){var t=e.row;return[n("div",{staticClass:"tui-totara_useraction-scheduledActions__row-expandedWrapper"},[n("RuleExtraDetail",{attrs:{rule:t}})],1)]}}])}),e._v(" "),e.scheduledActions&&e.scheduledActions.total>0?n("Paging",{attrs:{page:e.page,"items-per-page":e.pageSize,"total-items":e.scheduledActions.total},on:{"page-change":e.handlePageChange,"count-change":e.handlePageSizeChange}}):e._e()],1)]},proxy:!0},{key:"modals",fn:function(){return[n("ConfirmationModal",{attrs:{open:e.deleteConfirmationOpen,title:e.$str("delete_scheduled_action","totara_useraction"),"confirm-button-text":e.$str("delete","core"),loading:e.deleting},on:{confirm:e.handleDeleteConfirm,cancel:e.handleDeleteCancel}},[e._v("\n      "+e._s(e.$str("delete_scheduled_action_confirm_message","totara_useraction"))+"\n    ")])]},proxy:!0}])})}),[],!1,null,null,null);T(E),E.options.__hasBlocks={script:!0,template:!0};const O=E.exports},wWJ2:(e,t,n)=>{"use strict";function i(e,t,n,i,a,r,s,o){var u,l="function"==typeof e?e.options:e;if(t&&(l.render=t,l.staticRenderFns=n,l._compiled=!0),i&&(l.functional=!0),r&&(l._scopeId="data-v-"+r),s?(u=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),a&&a.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},l._ssrRegister=u):a&&(u=o?function(){a.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:a),u)if(l.functional){l._injectStyles=u;var d=l.render;l.render=function(e,t){return u.call(t),d(e,t)}}else{var c=l.beforeCreate;l.beforeCreate=c?[].concat(c,u):[u]}return{exports:e,options:l}}n.d(t,{Z:()=>i})},IpiT:e=>{"use strict";e.exports=tui.require("tui/components/buttons/Button")},"6e83":e=>{"use strict";e.exports=tui.require("tui/components/dropdown/DropdownItem")},"3NWB":e=>{"use strict";e.exports=tui.require("tui/components/dropdown/Dropdown")},qhSB:e=>{"use strict";e.exports=tui.require("tui/components/form/InputSizedText")},ijCJ:e=>{"use strict";e.exports=tui.require("tui/components/layouts/LayoutOneColumn")}},t={};function n(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){"use strict";"undefined"!=typeof tui&&tui._bundle.isLoaded("totara_useraction")?console.warn('[tui bundle] The bundle "totara_useraction" is already loaded, skipping initialisation.'):(tui._bundle.register("totara_useraction"),tui._bundle.addModulesFromContext("totara_useraction/components",n("hqj3")),tui._bundle.addModulesFromContext("totara_useraction/pages",n("r1xD")))}()})();