(()=>{var t={x4dL:(t,e,n)=>{var o={"./MultiLangBlock":"b6FE","./MultiLangBlock.vue":"b6FE","./MultiLangBlockCollection":"Igyp","./MultiLangBlockCollection.vue":"Igyp","./form/SimpleMultiLangForm":"tKRh","./form/SimpleMultiLangForm.vue":"tKRh","./modal/EditSimpleMultiLangModal":"sy7Y","./modal/EditSimpleMultiLangModal.vue":"sy7Y"};function a(t){var e=i(t);return n(e)}function i(t){if(!n.o(o,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return o[t]}a.keys=function(){return Object.keys(o)},a.resolve=i,t.exports=a,a.id="x4dL"},Ynos:(t,e,n)=>{var o={"./extension":"3yRE","./extension.js":"3yRE","./plugin":"/fT9","./plugin.js":"/fT9"};function a(t){var e=i(t);return n(e)}function i(t){if(!n.o(o,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return o[t]}a.keys=function(){return Object.keys(o)},a.resolve=i,t.exports=a,a.id="Ynos"},b6FE:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>v});var o=n("TVjX"),a=n.n(o),i=n("1+j7"),l=n.n(i);const s=tui.require("tui/components/icons/Edit");var r=n.n(s);const c=tui.require("tui/components/icons/Delete");var u=n.n(c);const _=tui.require("tui/components/modal/ModalPresenter");var d=n.n(_);const m=tui.require("weka_simple_multi_lang/components/modal/EditSimpleMultiLangModal");var g=n.n(m);const p={components:{ButtonIcon:l(),Edit:r(),Delete:u(),ModalPresenter:d(),EditMultiLangModal:g()},extends:a(),data:()=>({editModal:!1}),computed:{language(){return this.attrs.lang},langContentJson(){const t=[];return this.node.content.forEach((e=>t.push(e.toJSON()))),t},removable(){return!this.editorDisabled&&this.attrs.siblings_count>2},editLanguageAriaLabel(){return this.$str("edit_language_x","weka_simple_multi_lang",this.language||this.$str("unspecified","weka_simple_multi_lang"))},removeLanguageAriaLabel(){return this.$str("remove_language_x","weka_simple_multi_lang",this.language||this.$str("unspecified","weka_simple_multi_lang"))},editorCompact(){return this.context.getCompact()},placeholderResolverClass(){return this.context.getPlaceholderResolverClassName()}},methods:{handleUpdateLangContent({lang:t,content:e}){const n={attrs:{lang:t,siblings_count:this.attrs.siblings_count},content:e};this.editModal=!1,this.context.updateSelf(n,this.getRange)},handleRemoving(){this.context.removeSelf(this.getRange)}}},h=function(t){t.options.__langStrings={weka_simple_multi_lang:["edit_language_x","remove_language_x","unspecified","language_label"]}};var k=(0,n("wWJ2").Z)(p,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tui-wekaMultiLangBlock",attrs:{contenteditable:"false"}},[n("ModalPresenter",{attrs:{open:t.editModal},on:{"request-close":function(e){t.editModal=!1}}},[n("EditMultiLangModal",{attrs:{lang:t.language,content:t.langContentJson,"editor-compact":t.editorCompact,"placeholder-resolver-class":t.placeholderResolverClass},on:{submit:t.handleUpdateLangContent}})],1),t._v(" "),n("div",{staticClass:"tui-wekaMultiLangBlock__container"},[n("div",{staticClass:"tui-wekaMultiLangBlock__wrapper"},[n("div",{staticClass:"tui-wekaMultiLangBlock__languageWrapper"},[n("div",{staticClass:"tui-wekaMultiLangBlock__language"},[t._v("\n          "+t._s(t.$str("language_label","weka_simple_multi_lang",t.language||t.$str("unspecified","weka_simple_multi_lang")))+"\n        ")]),t._v(" "),n("div",{staticClass:"tui-wekaMultiLangBlock__actions"},[t.editorDisabled?t._e():n("ButtonIcon",{attrs:{"aria-label":t.editLanguageAriaLabel,styleclass:{transparent:!0,transparentNoPadding:!0}},on:{click:function(e){t.editModal=!0}}},[n("Edit",{attrs:{size:100}})],1)],1)]),t._v(" "),n("div",{ref:"content",staticClass:"tui-wekaMultiLangBlock__texts"})]),t._v(" "),t.removable?n("ButtonIcon",{staticClass:"tui-wekaMultiLangBlock__remove",attrs:{"aria-label":t.removeLanguageAriaLabel,styleclass:{transparent:!0,transparentNoPadding:!0}},on:{click:t.handleRemoving}},[n("Delete",{attrs:{size:100}})],1):t._e()],1)],1)}),[],!1,null,null,null);h(k),k.options.__hasBlocks={script:!0,template:!0};const v=k.exports},Igyp:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>d});var o=n("TVjX"),a=n.n(o),i=n("1+j7"),l=n.n(i);const s=tui.require("tui/components/icons/Add");var r=n.n(s);const c={components:{ButtonIcon:l(),Add:r()},extends:a(),computed:{isActionSpacingRequired(){return this.node.content.content.length>2}},methods:{insertNewLangBlock(){this.context.insertNewLangBlock(this.getRange)}}},u=function(t){t.options.__langStrings={weka_simple_multi_lang:["add_new","remove_collection_block"]}};var _=(0,n("wWJ2").Z)(c,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tui-wekaMultiLangBlockCollection"},[n("div",{ref:"content",staticClass:"tui-wekaMultiLangBlockCollection__content"}),t._v(" "),n("div",{staticClass:"tui-wekaMultiLangBlockCollection__actions",class:{"tui-wekaMultiLangBlockCollection__actions--spacing":t.isActionSpacingRequired}},[t.editorDisabled?t._e():n("ButtonIcon",{attrs:{"aria-label":t.$str("add_new","weka_simple_multi_lang"),styleclass:{transparentNoPadding:!0}},on:{click:t.insertNewLangBlock}},[n("Add",{attrs:{size:300}})],1)],1)])}),[],!1,null,null,null);u(_),_.options.__hasBlocks={script:!0,template:!0};const d=_.exports},tKRh:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>y});const o=tui.require("tui/components/uniform/Uniform");var a=n.n(o);const i=tui.require("editor_weka/components/Weka");var l=n.n(i);const s=tui.require("editor_weka/WekaValue");var r=n.n(s);const c=tui.require("tui/components/form/FormRow");var u=n.n(c);const _=tui.require("tui/components/uniform/FormText");var d=n.n(_);const m=tui.require("tui/components/uniform/FormField");var g=n.n(m);const p=tui.require("tui/components/buttons/ButtonGroup");var h=n.n(p);const k=tui.require("tui/components/buttons/Button");var v=n.n(k);const f=tui.require("tui/components/buttons/Cancel");var w=n.n(f);const b={components:{Uniform:a(),FormRow:u(),FormText:d(),FormField:g(),Weka:l(),ButtonGroup:h(),Cancel:w(),Button:v()},props:{lang:{type:String,validator:t=>t.length<=5},content:{type:Array,validator:t=>t.every((t=>t.type&&("paragraph"===t.type||"heading"===t.type))),default:()=>[]},editorCompact:Boolean,editorExtraExtensions:{type:Array,default:()=>[],validator:t=>t.every((t=>"name"in t))}},data(){let t=null;return this.content.length&&(t=r().fromDoc({type:"doc",content:this.content})),{formValue:{lang:{type:String,value:this.lang},content:{type:r(),value:t}}}},methods:{submitForm(t){const e={lang:t.lang.value,content:[]},{content:n}=t.content.value.getDoc();n&&n.length&&(e.content=n),this.$emit("submit",e)},validateContentEditor(t){return t?t.isEmpty?this.$str("required","core"):"":this.$str("required","core")}}},C=function(t){t.options.__langStrings={weka_simple_multi_lang:["lang_code","content","content_help","lang_code_help"],totara_core:["save"],core:["required"]}};var x=(0,n("wWJ2").Z)(b,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Uniform",{staticClass:"tui-wekaSimpleMultiLangForm",attrs:{"initial-values":t.formValue,"input-width":"full"},on:{submit:t.submitForm}},[n("FormRow",{attrs:{label:t.$str("lang_code","weka_simple_multi_lang"),required:!0,helpmsg:t.$str("lang_code_help","weka_simple_multi_lang")}},[[n("FormText",{attrs:{name:["lang","value"],maxlength:5,"char-length":5,validations:function(t){return[t.required()]}}})]],2),t._v(" "),n("FormRow",{attrs:{label:t.$str("content","weka_simple_multi_lang"),required:!0,helpmsg:t.$str("content_help","weka_simple_multi_lang")}},[[n("FormField",{attrs:{name:["content","value"],"char-length":"full",validate:t.validateContentEditor},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.value,a=e.update;return[n("Weka",{attrs:{value:o,compact:t.editorCompact,"extra-extensions":t.editorExtraExtensions,variant:"simple"},on:{input:a}})]}}])})]],2),t._v(" "),n("ButtonGroup",{staticClass:"tui-wekaSimpleMultiLangForm__buttonGroup"},[[n("Button",{attrs:{styleclass:{primary:!0},text:t.$str("save","totara_core"),"aria-label":t.$str("save","totara_core"),type:"submit"}}),t._v(" "),n("Cancel",{on:{click:function(e){return t.$emit("cancel")}}})]],2)],1)}),[],!1,null,null,null);C(x),x.options.__hasBlocks={script:!0,template:!0};const y=x.exports},sy7Y:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>d});const o=tui.require("weka_simple_multi_lang/components/form/SimpleMultiLangForm");var a=n.n(o);const i=tui.require("tui/components/modal/Modal");var l=n.n(i);const s=tui.require("tui/components/modal/ModalContent");var r=n.n(s);const c={components:{MultiLangForm:a(),Modal:l(),ModalContent:r()},props:{lang:String,content:Array,editorCompact:Boolean,placeholderResolverClass:String},computed:{editorExtraExtensions(){return this.placeholderResolverClass?[{name:"weka_notification_placeholder_extension",options:{resolver_class_name:this.placeholderResolverClass}}]:[]}}},u=function(t){t.options.__langStrings={weka_simple_multi_lang:["edit_language"]}};var _=(0,n("wWJ2").Z)(c,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Modal",{staticClass:"tui-wekaEditSimpleMultiLangModal",attrs:{size:"large",dismissable:{esc:!1,backdropClick:!1}}},[n("ModalContent",{attrs:{title:t.$str("edit_language","weka_simple_multi_lang"),"close-button":!0}},[n("MultiLangForm",{attrs:{lang:t.lang,content:t.content,"editor-compact":t.editorCompact,"editor-extra-extensions":t.editorExtraExtensions},on:{submit:function(e){return t.$emit("submit",e)},cancel:function(e){return t.$emit("request-close")}}})],1)],1)}),[],!1,null,null,null);u(_),_.options.__hasBlocks={script:!0,template:!0};const d=_.exports},"3yRE":(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>v});const o=tui.require("editor_weka/extensions/Base");var a=n.n(o);const i=tui.require("weka_simple_multi_lang/components/MultiLangBlock");var l=n.n(i);const s=tui.require("weka_simple_multi_lang/components/MultiLangBlockCollection");var r=n.n(s);const c=tui.require("editor_weka/toolbar"),u=tui.require("tui/i18n"),_=tui.require("tui/util"),d=tui.require("tui/components/icons/MultiLang");var m=n.n(d),g=n("/fT9"),p=n("Xz/0");const h=tui.require("editor_weka/extensions/util");tui.require("ext_prosemirror/view");class k extends(a()){nodes(){return{weka_simple_multi_lang_lang_block:{schema:{atom:!0,selectable:!1,isolating:!0,group:"weka_simple_multi_lang_lang_blocks",draggable:!1,content:"(paragraph|heading)*",allowGapCursor:!1,attrs:{lang:{default:void 0},siblings_count:{default:1}},toDOM:t=>["div",{class:"tui-wekaMultiLangBlock","data-attrs":JSON.stringify({lang:t.attrs.lang,siblings_count:t.attrs.siblings_count})},0],parseDOM:[{tag:"div.tui-wekaMultiLangBlock",getAttrs:h.getJsonAttrs}]},component:l(),componentContext:{removeSelf:this._removeLangBlock.bind(this),updateSelf:this._updateLangBlock.bind(this),getCompact:()=>this.options.compact||!1,getPlaceholderResolverClassName:()=>this.options.placeholder_resolver_class_name||null}},weka_simple_multi_lang_lang_blocks:{schema:{atom:!0,draggable:!1,selectable:!0,isolating:!0,group:"block",content:"weka_simple_multi_lang_lang_block+",allowGapCursor:!1,toDOM:()=>["div",{class:"tui-wekaMultiLangBlockCollection"},0],parseDOM:[{tag:"div.tui-wekaMultiLangBlockCollection"}]},component:r(),componentContext:{insertNewLangBlock:this._insertNewLangBlock.bind(this)}}}}toolbarItems(){return this.options.is_active?[new c.ToolbarItem({group:"embeds",label:(0,u.langString)("multi_lang","weka_simple_multi_lang"),iconComponent:m(),execute:this._createCollectionBlock.bind(this)})]:[]}plugins(){return[(0,g.default)({handleKeyDown:this._handleKeyDown.bind(this)})]}keymap(t){this.options.is_active&&t("Ctrl-m",this._createCollectionBlock.bind(this))}loadSerializedVisitor(){return{weka_simple_multi_lang_lang_blocks:t=>{t.content.forEach((e=>{e.attrs||(e.attrs={}),e.attrs.siblings_count=t.content.length}))}}}saveSerializedVisitor(){return{weka_simple_multi_lang_lang_blocks:t=>{t.content.forEach((t=>{delete t.attrs.siblings_count}))}}}_createCollectionBlock(){const{from:t,to:e}=(0,_.pick)(this.editor.state.selection,["from","to"]);this.editor.execute(((n,o)=>{const{tr:a}=n;a.replaceWith(t,e,[n.schema.node("weka_simple_multi_lang_lang_blocks",{},[n.schema.node("weka_simple_multi_lang_lang_block",{siblings_count:2}),n.schema.node("weka_simple_multi_lang_lang_block",{siblings_count:2})])]),o(a)}))}_removeLangBlock(t){const{from:e}=t(),n=this.doc.resolve(e),o=this.doc.resolve(n.end());let a=o.node();"weka_simple_multi_lang_lang_blocks"===a.type.name?a.content.content.length<=2?console.warn("[Weka] cannot remove another single lang block due to the minimum requirement"):this.editor.execute(((t,e)=>{const{schema:i,tr:l}=t;a=a.toJSON(),a.content=a.content.filter(((t,e)=>e!==n.index()));const s=a.content.length;a.content=a.content.map((t=>((t=Object.assign({},t)).attrs=Object.assign({},t.attrs,{siblings_count:s}),t))),l.replaceWith(o.before(),o.after(),i.nodeFromJSON(a)),e(l),this.editor.view.focus()})):console.error("[Weka] cannot resolve the position of parent collection node")}_updateLangBlock({attrs:t,content:e},n){const{from:o,to:a}=n();this.editor.execute(((n,i)=>{const{tr:l}=n,s=e.map((t=>n.schema.nodeFromJSON(t)));i(l.replaceWith(o,a,n.schema.node("weka_simple_multi_lang_lang_block",t,s)))})),this.editor.view.focus()}_insertNewLangBlock(t){const{to:e}=t(),n=this.editor.state.doc.resolve(e-1);let o=n.node();if("weka_simple_multi_lang_lang_blocks"!==o.type.name)return void console.warn(`Unable to resolve node 'weka_simple_multi_lang_lang_blocks' from the position ${e}`);o=o.toJSON();const a=o.content.length;o.content=o.content.map((t=>((t=Object.assign({},t)).attrs=Object.assign({},t.attrs,{siblings_count:a+1}),t))),this.editor.execute(((t,e)=>{const{tr:i,schema:l}=t;i.replaceWith(n.before(),n.after(),l.nodeFromJSON(o)),i.insert(n.end(),l.node("weka_simple_multi_lang_lang_block",{siblings_count:a+1})),e(i)})),this.editor.view.focus()}_handleKeyDown(t,e){switch(e.key){case"Enter":return this._createNewLine(t);case"Backspace":case"Delete":return this._handleRemoveCollectionBlocKFromBackspace(t);default:const e=t.state.tr.selection.$from.node();return!(!e||"weka_simple_multi_lang_lang_blocks"!==e.type.name&&"weka_simple_multi_lang_lang_block"!==e.type.name)}}_createNewLine(t){const e=t.state.tr.selection.$from,n=e.node();let o=(()=>{switch(n.type.name){case"weka_simple_multi_lang_lang_blocks":return e.after();case"weka_simple_multi_lang_lang_block":return this.doc.resolve(e.before()).after();case"paragraph":case"heading":if("weka_simple_multi_lang_lang_block"===e.node(e.depth-1).type.name){const n=t.state.doc.resolve(e.before());return t.state.doc.resolve(n.before()).after()}return null;default:return null}})();return null!==o&&(this.editor.execute(((t,e)=>{const{tr:n}=t;n.insert(o,t.schema.nodes.paragraph.createAndFill()),n.setSelection(new p.TextSelection(n.doc.resolve(o+1))),e(n)})),!0)}_handleRemoveCollectionBlocKFromBackspace(t){const e=t.state.tr.selection.$from,n=e.node();return"weka_simple_multi_lang_lang_blocks"===n.type.name?((({from:t,to:e})=>{this.editor.execute(((n,o)=>{const{tr:a}=n;a.delete(t,e),o(a)}))})({from:e.before(),to:e.after()}),!0):"weka_simple_multi_lang_lang_block"===n.type.name||"paragraph"===n.type.name&&"weka_simple_multi_lang_lang_block"===e.node(e.depth-1).type.name}}const v=t=>new k(t)},"/fT9":(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var o=n("Xz/0");function a({handleKeyDown:t}){const e=new o.PluginKey("weka_simple_multi_lang");return new o.Plugin({key:e,props:{handleKeyDown:t}})}},wWJ2:(t,e,n)=>{"use strict";function o(t,e,n,o,a,i,l,s){var r,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=n,c._compiled=!0),o&&(c.functional=!0),i&&(c._scopeId="data-v-"+i),l?(r=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),a&&a.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(l)},c._ssrRegister=r):a&&(r=s?function(){a.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:a),r)if(c.functional){c._injectStyles=r;var u=c.render;c.render=function(t,e){return r.call(e),u(t,e)}}else{var _=c.beforeCreate;c.beforeCreate=_?[].concat(_,r):[r]}return{exports:t,options:c}}n.d(e,{Z:()=>o})},TVjX:t=>{"use strict";t.exports=tui.require("editor_weka/components/nodes/BaseNode")},"Xz/0":t=>{"use strict";t.exports=tui.require("ext_prosemirror/state")},"1+j7":t=>{"use strict";t.exports=tui.require("tui/components/buttons/ButtonIcon")}},e={};function n(o){var a=e[o];if(void 0!==a)return a.exports;var i=e[o]={exports:{}};return t[o](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},function(){"use strict";"undefined"!=typeof tui&&tui._bundle.isLoaded("weka_simple_multi_lang")?console.warn('[tui bundle] The bundle "weka_simple_multi_lang" is already loaded, skipping initialisation.'):(tui._bundle.register("weka_simple_multi_lang"),tui._bundle.addModulesFromContext("weka_simple_multi_lang",n("Ynos")),tui._bundle.addModulesFromContext("weka_simple_multi_lang/components",n("x4dL")))}()})();