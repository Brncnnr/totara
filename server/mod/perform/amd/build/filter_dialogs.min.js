define(["jquery","core/config","core/str"],function(a,b){var c={waitingitems:[],reportid:0,init:function(b,d,e){c.waitingitems.push({filter:b,name:d}),c.reportid=e,window.dialogsInited?this.rb_init_filter_dialogs():(a.isArray(window.dialoginits)||(window.dialoginits=[]),1===this.waitingitems.length&&window.dialoginits.push(this.rb_init_filter_dialogs))},rb_init_filter_dialogs:function(){var b=a.extend(!0,[],c.waitingitems);c.waitingitems=[],a.each(b,function(){switch(this.filter){case"element-type":c.rb_load_element_type_filters(this);break;case"additional-linked_review_content_type":c.rb_load_review_type_filters(this);break;case"participant_instance-relationship_id":c.rb_load_participant_instance_relationship_id_filters(this);break;case"section-id":c.rb_load_section_title_filters(this)}}),a(document).on("click",".multiselect-selected-item a",function(b){b.preventDefault();var c=a(this).parents("div.multiselect-selected-item"),d=c.data("filtername"),e=c.data("id"),f=a("input[name="+d+"]"),g=f.val(),h=g.split(","),i=a.grep(h,function(a){return a!=e}),j=i.join(",");f.val(j),c.remove()})},rb_load_element_type_filters:function(d){c.rb_disable_dialog(d.filter),a("input.rb-filter-choose-"+d.filter).each(function(){var e=a(this).attr("id");e=e.substr(5,e.length-12);var f=b.wwwroot+"/mod/perform/reporting/performance/filters/";c.performMultiSelectDialogRbFilter(e,M.util.get_string("choose_"+d.filter.replace("-","_")+"_plural","mod_perform"),f+"element_type.php?action=find&sesskey="+b.sesskey,f+"element_type.php?action=save&filtername="+e+"&sesskey="+b.sesskey+"&ids="),"0"===a("select[name="+e+"_op]").val()&&a("#show-"+e+"-dialog").prop("disabled",!0)})},rb_load_review_type_filters:function(d){c.rb_disable_dialog(d.filter),a("input.rb-filter-choose-review-type").each(function(){var d=a(this).attr("id");d=d.substr(5,d.length-12);var e=b.wwwroot+"/mod/perform/reporting/performance/filters/";c.performMultiSelectDialogRbFilter(d,M.util.get_string("choose_review_type_plural","performelement_linked_review"),e+"review_type.php?action=find&sesskey="+b.sesskey,e+"review_type.php?action=save&filtername="+d+"&sesskey="+b.sesskey+"&ids="),"0"===a("select[name="+d+"_op]").val()&&a("#show-"+d+"-dialog").prop("disabled",!0)})},rb_load_participant_instance_relationship_id_filters:function(d){c.rb_disable_dialog(d.filter),a("input.rb-filter-choose-relationship-name").each(function(){var d=a(this).attr("id");d=d.substr(5,d.length-12);var e=b.wwwroot+"/mod/perform/reporting/performance/filters/";c.performMultiSelectDialogRbFilter(d,M.util.get_string("choose_relationship_name_plural","mod_perform"),e+"relationship_name.php?action=find&sesskey="+b.sesskey,e+"relationship_name.php?action=save&filtername="+d+"&sesskey="+b.sesskey+"&ids="),"0"===a("select[name="+d+"_op]").val()&&a("#show-"+d+"-dialog").prop("disabled",!0)})},rb_load_section_title_filters:function(d){a("input[name=activity_id]").length?(c.rb_disable_dialog(d.filter),a("input.rb-filter-choose-"+d.filter).each(function(){var e=a(this).attr("id");e=e.substr(5,e.length-12);var f=a("input[name=activity_id]").val(),g=b.wwwroot+"/mod/perform/reporting/performance/filters/section_title.php?sesskey="+b.sesskey+"&activity_id="+f+"&action=";c.performMultiSelectDialogRbFilter(e,M.util.get_string("choose_"+d.filter.replace("-","_")+"_plural","mod_perform"),g+"find",g+"save&filtername="+e+"&ids="),"0"===a("select[name="+e+"_op]").val()&&a("#show-"+e+"-dialog").prop("disabled",!0)})):(a("#id_section-id_op").prop("disabled",!0),a("#show-section-id-dialog").prop("disabled",!0),a("#fgroup_id_section-id_grp").hide())},rb_disable_dialog:function(b){a(document).on("change","#id_"+b+"_op",function(b){b.preventDefault();var c=a(this).attr("name");c=c.substr(0,c.length-3),"0"===a(this).val()?(a("#show-"+c+"-dialog").addClass("disabled"),a("#show-"+c+"-dialog").prop("disabled",!0),a("#show-"+c+"-dialog").removeAttr("href"),a('*[data-filtername="'+c+'"] a').addClass("disabled"),a('*[data-filtername="'+c+'"] a').prop("disabled",!0),a('*[data-filtername="'+c+'"] a').removeAttr("href")):(a("#show-"+c+"-dialog").removeClass("disabled"),a("#show-"+c+"-dialog").prop("disabled",!1),a("#show-"+c+"-dialog").attr("href","#"),a('*[data-filtername="'+c+'"] a').removeClass("disabled"),a('*[data-filtername="'+c+'"] a').prop("disabled",!1),a('*[data-filtername="'+c+'"] a').attr("href","#"))})},performMultiSelectDialogRbFilter:function(b,c,d,e){var f=new totaraDialog_handler_treeview_multiselect_rb_filter;f._get_ids=function(b){var c=[];return b.each(function(){var b=a(this).attr("id").slice(5);c.push(b)}),c},f._update=function(b){var c=this._title,d=a("input[name="+c+"]"),e=d.val(),f=e?e.split(","):[];a("#"+c+" .selected .clickable").each(function(){f.push(a(this).attr("id").slice(5))});var g=f.join(",");d.val(g),this._dialog.hide();var h=a("div.list-"+this._title);h.replaceWith(b),a(".totara-noscript",a("div.list-"+this._title)).hide()};var g="input[name="+b+"_selection_limit]";a(g)&&f.set_selection_limit(a(g).val());var h={};h[M.util.get_string("save","totara_core")]=function(){f._save(e)},h[M.util.get_string("cancel","moodle")]=function(){f._cancel()},totaraDialogs[b]=new totaraDialog(b,"show-"+b+"-dialog",{buttons:h,title:"<h2>"+c+"</h2>"},d,f)}};return c});